(window.webpackJsonp=window.webpackJsonp||[]).push([[41,50],{1:function(e,t){},2:function(e,t){},"4YNh":function(e,t,r){"use strict";r.r(t);var a=r("oTir"),o=r("rn6b"),n=r("Kwrx"),i=r("CKgU"),s=r("s1Pg"),c=r("KUYp"),l=r("tmJK"),d={expandAction:r("ghbr").a.oneOf(["false","click","dblclick"]).def("click")},c={name:"SmDirectoryTree",defaultComponent:c.default,mixins:[a.a,l.a],inheritAttrs:!1,model:{prop:"checkedKeys",event:"check"},props:d,computed:{extralListeners:function(){var e=this;return{check:function(){e.$emit.apply(e,["check"].concat(Array.prototype.slice.call(arguments)))}}}}},l=r("KHd+"),d=Object(l.a)(c,void 0,void 0,!1,null,null,null).exports,c=r("hdLw"),c=r.n(c),p=r("7L49");function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==h(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!==h(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===h(e)?e:String(e)}(a.key),a)}}function y(e,t){return(y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function f(r){var a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=m(r),t=(e=a?(e=m(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===h(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var v=function(e){var t=o;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&y(t,e);var r,a=f(o);function o(){var e;if(this instanceof o)return(e=a.call(this)).cacheMaps={},e.cacheIServerMaps={},e.readyNext=!0,e.mapQuene=[],e;throw new TypeError("Cannot call a class as a function")}return t=o,(e=[{key:"setMap",value:function(e){var t=e.map,e=e.mapTarget;this.map=t,this.mapTarget=e}},{key:"addLayer",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=t.nodeKey,a=t.serverUrl,o=t.mapId,n=t.withCredentials,n=void 0!==n&&n,i=t.layerFilter,t=t.proxy;this.cacheMaps[r]||(this.readyNext?(this.webMapViewModel=new p.a(o,{serverUrl:a,withCredentials:n,proxy:t,target:this.mapTarget},{},this.map,i),this.readyNext=!1,this.webMapViewModel.on({addlayerssucceeded:function(){e.handleNextMap()}}),this.cacheMaps[r]=this.webMapViewModel):this.mapQuene.push({nodeKey:r,mapId:o,serverUrl:a,withCredentials:n,layerFilter:i,proxy:t}))}},{key:"handleNextMap",value:function(){var e,t,r,a,o;this.readyNext=!0,this.mapQuene.length&&(e=(o=this.mapQuene.shift()).nodeKey,t=o.serverUrl,r=o.mapId,a=o.withCredentials,o=o.layerFilter,this.addLayer({nodeKey:e,serverUrl:t,mapId:r,withCredentials:a,layerFilter:o}))}},{key:"addIServerLayer",value:function(e,t){var r;this.cacheIServerMaps[t]||(r=this.map.getCRS().epsgCode.split(":")[1],this.map.addLayer({id:t,type:"raster",source:{type:"raster",tiles:[e],tileSize:256,rasterSource:"iserver",prjCoordSys:{epsgCode:r}},minzoom:0,maxzoom:22}),this.cacheIServerMaps[t]=!0)}},{key:"addMapStyle",value:function(e,t){var a,r,o,n=this;this.cacheIServerMaps[t]||(a=[],r=(e=e||{}).layers,e=e.sources,o=void 0===e?{}:e,(void 0===r?[]:r).forEach(function(e){var t=e.source,r=o[e.source];t&&r&&(n.map.addSource(t,r),n.map.addLayer(e),a.push({sourceId:t,layerId:e.id}))}),this.cacheIServerMaps[t]=a)}},{key:"removeLayer",value:function(t){var e;this.handleNextMap(),this.mapQuene.length&&(e=this.mapQuene.findIndex(function(e){return e.nodeKey===t}),this.mapQuene.splice(e,1)),this.cacheMaps[t]&&(this.cacheMaps[t].cleanLayers(),delete this.cacheMaps[t])}},{key:"removeIServerLayer",value:function(e){this.cacheIServerMaps[e]&&delete this.cacheIServerMaps[e],this.map&&this.map.getLayer(e)&&(this.map.removeLayer(e),this.map.removeSource(e))}},{key:"removeMapStyle",value:function(e){var r=this,t=this.cacheIServerMaps[e];t&&this.map&&(delete this.cacheIServerMaps[e],t.forEach(function(e){var t=e.sourceId,e=e.layerId;r.map.getLayer(e)&&(r.map.removeLayer(e),r.map.removeSource(t))}))}},{key:"eachNode",value:function(e,t){for(var r=0;r<e.length;r++)t(e[r],e),e[r].children&&this.eachNode(e[r].children,t);return e}},{key:"removeLayerLoop",value:function(r){var a=this;r.mapInfo&&(r.mapInfo.mapId?this.removeLayer(r.key):r.mapInfo.mapOptions?this.removeMapStyle(r.key):r.mapInfo.serviceUrl&&this.removeIServerLayer(r.key)),r.children&&r.children.length&&r.children.forEach(function(e,t){a.removeLayerLoop(r.children[t])})}},{key:"removed",value:function(){var t=this;Object.keys(this.cacheMaps).forEach(function(e){t.removeLayer(e)}),Object.keys(this.cacheIServerMaps).forEach(function(e){t.removeIServerLayer(e),t.removeMapStyle(e)}),this.cacheMaps={},this.cacheIServerMaps={}}}])&&u(t.prototype,e),r&&u(t,r),Object.defineProperty(t,"prototype",{writable:!1}),o}(c.a.Evented),c=r("9csQ"),S=r.n(c),c=r("zT9C"),b=r.n(c),c=r("XaGS"),k=r.n(c),r={name:"SmLayerManager",components:{SmCard:s.a,SmDirectoryTree:d},mixins:[a.a,o.a,i.a,n.a],props:{iconClass:{type:String,default:"sm-components-icon-layer-manager"},headerName:{type:String,default:function(){return this.$t("layerManager.title")}},layers:{type:Array},replaceFields:{type:Object,default:function(){return{children:"children",title:"title",key:"key"}}},defaultExpandAll:{type:Boolean,default:!1}},data:function(){return{treeData:null,checkedKeys:[],mapIsLoad:!1}},watch:{layers:{handler:function(e,t){t&&!k()(e,t)&&this.cleanStatus(),this.treeData=b()(e),this.insertProperty(this.treeData)},deep:!0,immediate:!0}},created:function(){this.viewModel=new v},methods:{checkNode:function(e,t){var s=this;this.checkedKeys=e,t.checked?t.checkedNodes&&t.checkedNodes.length&&t.checkedNodes.forEach(function(e){var t,r,a,o,n,i=e.data.props.mapInfo;i&&(e=e.key,i.mapId&&i.serverUrl?(t=i.serverUrl,r=i.mapId,a=i.withCredentials,o=i.layerFilter,n=i.proxy,s.addLayer({nodeKey:e,serverUrl:t,mapId:r,withCredentials:a,layerFilter:o,proxy:n})):i.mapOptions?s.addMapStyle(i.mapOptions.style,e):i.serverUrl&&s.addIServerLayer(i.serverUrl,e))}):(e=t.node.dataRef,this.viewModel.removeLayerLoop(e))},addLayer:function(e){var t=e.nodeKey,r=e.serverUrl,a=e.mapId,o=e.withCredentials,n=e.layerFilter,e=e.proxy;this.mapIsLoad&&this.viewModel.addLayer({nodeKey:t,serverUrl:r,mapId:a,withCredentials:o,layerFilter:n,proxy:e})},removeLayer:function(e){this.mapIsLoad&&this.viewModel.removeLayer(e)},addIServerLayer:function(e,t){this.mapIsLoad&&this.viewModel.addIServerLayer(e,t)},addMapStyle:function(e,t){this.mapIsLoad&&this.viewModel.addMapStyle(e,t)},removeIServerLayer:function(e){this.mapIsLoad&&this.viewModel.removeIServerLayer(e)},removeMapStyle:function(e){this.mapIsLoad&&this.viewModel.removeMapStyle(e)},insertProperty:function(e){this.eachNode(e,function(e){e.key||(e.key=S()("key_")),e.selectable=!1,e.children||e.mapInfo?!e.children&&e.mapInfo&&(e.disableCheckbox&&(e.disableCheckbox=!1),e.disabled)&&(e.disabled=!1):(e.disableCheckbox=!0,e.disabled=!0),e.scopedSlots||(e.children?e.scopedSlots={title:"title"}:e.scopedSlots={title:"title",mapInfo:"mapInfo"})})},eachNode:function(e,t){for(var r=0;r<e.length;r++)t(e[r],e),e[r].children&&this.eachNode(e[r].children,t);return e},cleanStatus:function(){var t=this;this.checkedKeys.length&&this.checkedKeys.forEach(function(e){t.removeLayer(e),t.removeIServerLayer(e),t.removeMapStyle(e)}),this.checkedKeys=[]}},loaded:function(){this.mapIsLoad=!0},removed:function(){this.checkedKeys=[]}},c=Object(l.a)(r,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("sm-collapse-card",{directives:[{name:"show",rawName:"v-show",value:t.isShow,expression:"isShow"}],staticClass:"sm-component-layer-manager",attrs:{"icon-class":t.iconClass,"icon-position":t.position,"header-name":t.headerName,"auto-rotate":t.autoRotate,collapsed:t.collapsed,background:t.background,textColor:t.textColor,"split-line":t.splitLine}},[r("sm-card",{staticClass:"sm-component-layer-manager__sm-card",style:t.headingTextColorStyle},[r("div",{staticClass:"sm-component-layer-manager__content"},[r("sm-directory-tree",{style:t.getTextColorStyle,attrs:{checkable:"",defaultExpandAll:t.defaultExpandAll,treeData:t.treeData,checkedKeys:t.checkedKeys,replaceFields:t.replaceFields},on:{check:t.checkNode},scopedSlots:t._u([{key:"title",fn:function(e){e=e.title;return[r("div",{staticClass:"item-title"},[r("span",{style:t.headingTextColorStyle},[t._v("\n              "+t._s(e)+"\n            ")])])]}}])})],1)])],1)},[],!1,null,null,null);t.default=c.exports}}]);