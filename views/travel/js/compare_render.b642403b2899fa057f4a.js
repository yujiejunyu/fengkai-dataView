(window.webpackJsonp=window.webpackJsonp||[]).push([[15,30,50],{"0m1j":function(t,e,n){"use strict";n("Tw3F")},1:function(t,e){},2:function(t,e){},"45Hi":function(t,e,n){t.exports=n.p+"static/img/tdt-vec.png"},"5zrt":function(t,e,n){t.exports=n.p+"static/img/tdt-ter.png"},"9N6+":function(t,e,n){"use strict";n("cRpN")},"9ad+":function(t,e,n){t.exports=n.p+"static/img/tdt-img.png"},GAzf:function(t,e,n){"use strict";var r=n("4zwu"),a=n("FuRH"),i=n("3Dh3"),o=n("+NyJ");e.a={data:function(){return{listenMapLoad:!1}},computed:{dataIds:function(){return this.component.dataIds||[]},dataId:function(){return this.dataIds[0]},currentDataCache:function(){return this.$store.getters.getDataCache(this.dataId)},components:function(){return this.$store.getters.components},componentType:function(){return this.component.componentType},mapTarget:function(){return this.component.propDatas.mapTarget},currentProps:function(){var t,e;return"server"===(t=this.renderProps).dataType&&0<this.dataIds.length&&(e=this.getValueProps(t),Object.assign(t,e)),t},labelConfig:function(){return Object(o.f)(this.component.componentId,this.dataId)}},beforeCreate:function(){this.watcher=[]},mounted:function(){this.listenMapLoad&&a.a.$on("load-map",this.loadMapSucceed)},beforeDestroy:function(){this.listenMapLoad&&a.a.$off("load-map",this.loadMapSucceed)},methods:{cleanWatcher:function(){this.watcher.forEach(function(t){t()}),this.watcher=[]},loadMapSucceed:function(t,e){e===this.mapTarget&&this.loadMap(e)},loadMap:function(){},getValueProps:function(t){var e=this.getFeatureId(this.dataId),e=this.currentDataCache&&this.currentDataCache.type&&-1!==this.currentDataCache.type.indexOf("time")&&t.filterCategoryValue?r.a.$options.getDataByCategory(this.currentDataCache,[t.filterCategoryValue])||{}:r.a.$options.getData(e)||{};return this.updateDataPropsHandler(t,{features:e})},getValueByField:function(t,e){var n=this.currentDataCache&&this.currentDataCache.type&&-1!==this.currentDataCache.type.indexOf("time"),t=t&&t.features&&t.features.features,n=n?t&&t.length-1:0,t=t&&0<=n&&t[n]&&t[n].properties[e];return t||0===t?t.toString():""},hasField:function(t,e){return t&&t.features&&t.features.features[0]&&t.features.features[0].properties.hasOwnProperty(e)},getFeatureId:function(t){return Object(i.g)(this.$store.getters.getDataCache,t)}}}},Lb6U:function(t,e,n){"use strict";e.a={highlight:"featureSelection"}},SCEM:function(t,e,n){},Su6f:function(t,e,n){},Tpw3:function(t,e,n){},Tw3F:function(t,e,n){},"US+v":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAAkCAYAAADVeVmEAAAAAXNSR0IArs4c6QAAApxJREFUaEPtmU2rElEYx89zmqlRw4Vg5qViiBAh7XqrjUshon2fQFQE/RLuBXfuRBFcuesLJK0TF9qLvUCIkkFxK2t0xvF4YiTiUl5fZs7BCWa2c57/8/89/5lh5gwgi0ehUBCCwSBYlNmpPBQK0UQisdhp8TmLTBstl8uXPR7PXYSQ34oBE7U/NE3rZLPZLyZqkSngSqVySxTF25RSwUxTqzWUUooQejcYDF4WCoXlPnp7AReLRY/f7793gFTXMlFKJ7PZrJ3L5b7uCr0zcLVavYkQimKMD5LqeUAAsCSEvEkmk68BwEh+47EVuNlsuhRFuQ8AV7aJHfj8N03T2tls9vsmHxuBa7WaDAB3EELigWF2ak8IMe7nV6lU6i1CaG3aa4FLpZLL5/MZT+CrO3Wy2SJCyKmqqs/z+fzPv639A1yv128sl8tjALhoM4697FBKCSHkRTqdfn+28A9wrVaTMMYnlNKjvZTtv/jz73t7alhdATcajWu6rp/876lumL2u63ovk8l8gHa7HQaAByyC0nV9ORwOTxVF0VnoSZIkyrLsE0URs9ATRfEZdDqdY0mSHrIQNDQmk8m03+9/YqEXDocDXq/Xw0LL0MAYt5gDq6qqdrvdjyxMRqPRoMvlcrHQcoBZTZFlwpFI5MjtdkusvHG5pI23nV6vN5zP58SKUeNBFYvFrgPABSs6Z2u5ABsNFosFmU6nqhWjbrf7kiAITD9UuAFbAeVZ6wDznK4dtJ2E7ZACTw9OwjynawdtJ2E7pMDTg5Mwz+naQdtJ2A4p8PTgJMxzunbQXiXc7XajgiA8soMh3h4A4CkoihIcjUaPCSHMNst4GzejjzHWAoHAk9VGfKvVEmRZFsbj8da/iWaa2aEmHo/rALD4BRGPJefMXZjnAAAAAElFTkSuQmCC"},YQ51:function(t,e,n){"use strict";var i=n("GbHz"),r={data:function(){return{eventList:[]}},computed:{listeners:function(){var t=this.component.componentId;return this.$store.getters.getListensByComponentId(t)},triggers:function(){return this.$store.getters.getActionsByComponentId(this.component.componentId)}},methods:{initListeners:function(){this.listenersHandler&&this.listenersHandler(this.listeners,[])},handleResetTriggers:function(t,e){if(e)for(var n in e){var r,a=null==(a=i.c[n])?void 0:a.resetHandlerName;a&&(r=e[n],n=t&&t[n]||[],0<r.length)&&0===n.length&&this[a]()}}}},n=n("KHd+"),n=Object(n.a)(r,void 0,void 0,!1,null,null,null);e.a=n.exports},aXEy:function(N,t,e){"use strict";e.r(t);var n=e("hdLw"),a=e.n(n),n=(e("xKWM"),e("oUIn")),d=e("QCDS"),p=e("3Dh3"),$=e("GAzf"),r=e("zT9C"),m=e.n(r),r=e("wd/R"),F=e.n(r),r=e("YY/H"),z=e.n(r),f=e("FuRH"),U=e("M7pi"),y=e("wyqS");function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function B(e,t){var n,r=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)),r}function h(r){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?B(Object(a),!0).forEach(function(t){var e,n;e=r,n=a[t=t],(t=function(t){t=function(t,e){if("object"!==i(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);n=n.call(t,e||"default");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"===i(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):B(Object(a)).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(a,t))})}return r}function R(t){var r,a,i,o,e,n=t.layerNames,s=t.mapTarget,c=t.dataCache,l=t.transformSucceeded,u=t.getFeaturesSucceeded;n instanceof Array&&(r=f.a.$options.getWebMap(s)||{},a=r._layers,i=[],o=[],n.forEach(function(e){var t,c,l,u,p,f,h,n=a.find(function(t){return t.layerID===e});n&&(o.push((t=(n={layer:n,webMap:r,mapTarget:s}).layer,c=n.webMap,l=n.mapName,u=n.mapTarget,p=t.dataSource,f=t.layerID,h=(p||{}).serverId||t.serverId,new Promise(function(e){var n={dataInfo:{name:f,displayName:"".concat(l||c.mapParams.title,"-").concat(f),mapTarget:u},frequency:2,timing:!1},t=p||{},r=t.type,a=t.dataSourceName,i=t.url,o=t.layerName,s=t.accessType;-1!==["REST_DATA","REST_MAP"].indexOf(r)?(t={type:"iServer",withCredentials:!1,url:i},o&&(t.layerName=o),a&&(t.dataName=[a]),t.id=i+(o||a||""),n.hashId=t.id,n.proxy="",Object.assign(n.dataInfo,t),e(n)):h?Object(y.d)("".concat(c.serverUrl,"web/datas/").concat(h),c.withCredentials).then(function(t){t={type:"iPortal",id:h,url:t.url,dataType:t.dataType,updateTime:F()(t.lastModfiedTime).format("YYYY-MM-DD HH:mm:ss"),serviceStatus:t.serviceStatus,dataItemServices:t.dataItemServices,withCredentials:!0,preferContent:"DIRECT"===s};n.hashId=h.toString(),n.proxy="",Object.assign(n.dataInfo,t),e(n)},function(){return e()}):e()}))),i.push(e))}),e=z()(n,i),o)&&o.length&&Promise.all(o).then(function(t){t=U.a.deduplicateData(t),t.forEach(function(s){s.dataInfo.attributeFilter||(s.dataInfo.attributeFilter="SmID>0"),s.dataInfo.maxFeatures||(s.dataInfo.maxFeatures=8),Object(y.a)(h(h({},s.dataInfo),{},{proxy:s.proxy}),function(t){var e,n=t.features,r=t.fields,a=t.fieldCaptions,i=t.fieldValues,o=t.transformed,t=t.error;n&&!t||(e="failed"),c[s.hashId]||u&&u(h(h({},s),{},{status:e}),{features:n,fields:r,fieldCaptions:a,fieldValues:i,transformed:o})})}),t=Object(p.a)(t.map(function(t){return t.dataInfo||{}})),t=Object.assign(t,{layerNames:e});l&&l(t)})}var r={computed:{layerNames:function(){var t=this.component.propDatas,e=t.searchControl,t=t.layerNames;return(void 0===e?{}:e).layerNames||t}},created:function(){this.layerNames&&this.layerNames.length&&(this.listenMapLoad=!0)},methods:{loadMap:function(){R({layerNames:this.layerNames,mapTarget:this.mapTarget,dataCache:this.$store.getters.dataCache,transformSucceeded:this.updateSearchProps,getFeaturesSucceeded:this.addDataCache})},dispatchUpdateDataProps:function(t){this.$store.dispatch("CHANGE_COMPONENT_PROPS_SETTING",{componentId:this.component.componentId,propDatas:t})},updateSearchProps:function(t){var e,n=m()(this.component.propDatas),r=n.searchControl||n;for(e in t){var a,i,o=t[e];"layerNames"===e?r[e]=o:0<o.length&&(i=r[e],a=r.dataIds||[],r[e]=i?i.concat(o):o,i=Array.from(new Set(a.concat(o.map(function(t){return t.hashId})))),r.dataIds=i)}this.dispatchUpdateDataProps(n)},addDataCache:function(t,e){this.$store.dispatch("ADD_DATA",{dataInfo:t,data:e})}}},G=e("qAG6"),g=e("4zwu");function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function K(t){return function(t){if(Array.isArray(t))return s(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){var n;if(t)return"string"==typeof t?s(t,e):"Map"===(n="Object"===(n=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(t,e):void 0}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function q(e,t){var n,r=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)),r}function c(r){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?q(Object(a),!0).forEach(function(t){var e,n;e=r,n=a[t=t],(t=function(t){t=function(t,e){if("object"!==o(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);n=n.call(t,e||"default");if("object"!==o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"===o(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):q(Object(a)).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(a,t))})}return r}var $={mixins:[$.a,r],computed:{layerDataIds:function(){var t={};if(this.dataIds)for(var e in this.dataIds)"searchControl"!==e&&"queryControl"!==e&&this.dataIds[e]&&0<this.dataIds[e].length&&(t[e]=this.dataIds[e]);return t},currentProps:function(){var t;return(t=this.defaultParams.props).layers=this.getFilterLayerFeatures(),t.trackLayers=this.getTrackLayersFeatures(),t},layerDataCache:function(){var n=this;return function(t,e){t=n.$store.getters.getDataCache(t)||{};return Object.assign({},t,n.filterActionData[e]||{})}}},watch:{dataIds:{handler:function(t,e){var r=this;if(this.cleanWatcher(),this.dataProps={},this.dataIds)for(var n in this.dataIds)!function(n){var t=r.dataIds[n];t?t.forEach(function(t){r.watcher.push(r.$watch(function(){return r.$store.getters.getDataIdFromDataCache(t)},function(t,e){!t&&!e&&r.component.componentId||t===e||r.handleWebMapUpdate(n)},{deep:!0,immediate:!0}))}):e&&e[n]&&r.resetWebMapInfo(),"trackLayers"===n&&r.resetTrackLayers(r.dataIds.trackLayers,e&&e.trackLayers)}(n)},immediate:!0},"currentProps.layersIdField":function(t,e){var n;if(t)for(var r in t)e&&t[r]!==e[r]&&((n=n||{})[r]=t[r]);n&&this.updateMapSelfLayers()}},methods:{handleWebMapUpdate:function(t){"searchControl"!==t&&"queryControl"!==t&&(this.getFilterLayerFeatures(),this.getTrackLayersFeatures())},getLayerFeatures:function(){var t,r=this,a={};for(t in this.layerDataIds)!function(n){r.layerDataIds[n]&&0<r.layerDataIds[n].length&&(a[n]=[],r.layerDataIds[n].forEach(function(t,e){t?(e="trackLayers"===n?"track-layer".concat(0<e?e:""):n,e=(t=r.layerDataCache(t,e)).featureId||g.a.timeDataId||t.data,a[n].push(g.a.$options.getData(e)||{})):a[n].push(void 0)}))}(t);return a},updateMapSelfLayers:function(i){var o,s,c=this,t=this.currentProps.target;f.a.$options.getMap(t)&&(t=(o=f.a.$options.getWebMap(t))._layers)&&(s=this.getLayerFeatures(),t.forEach(function(t){var e,n,r,a="".concat(t.layerID);(i&&i[t.layerID]||c.dataIds.hasOwnProperty(a))&&(e=(n=i&&i[t.layerID]||{}).mergeField,n=(n=(n=n.featureId)&&g.a.$options.getData(n)||s[a]&&s[a][0]||{}).features&&n.features.features,t.hasOwnProperty("themeSetting")&&n&&!Object(G.i)(n[0]&&n[0].properties,t.themeSetting.themeField)&&0!==Object(G.i)(n[0]&&n[0].properties,t.themeSetting.themeField)?c.$message.error(c.$t("setting.webMap.inValidDataTip")):(r=c.defaultParams.props.layersIdField||{},(t=m()(t)).projection="EPSG:4326",o.updateOverlayLayer(t,n,e||r[a])))}))},resetWebMapInfo:function(){this.updateMapSelfLayers()},diffData:function(t,e){var n,r;for(r in t)e&&e[r]&&t[r]!==e[r]&&((n=n||{})[r]=t[r]);return n},getFilterLayerFeatures:function(){var i,o=this.defaultParams.props.layers;return o&&o.length&&(i=this.getLayerFeatures(),o.forEach(function(t,e){var n=t.propDatas,r=n.attributeFilter,n=n.maxFeatures,t="layers_".concat(t.ref),t=i[t]&&i[t][0],t=t&&t.features,a={};r&&(a=Object(y.b)(r,n,t)),n&&!r&&(a=Object(y.c)(n,t)),o[e].propDatas.features=Object.freeze(a)})),Object.freeze(o)},getTrackLayersFeatures:function(){var o,s,c=this,l=this.defaultParams.props.trackLayers;return l&&l.length&&(o=this.getLayerFeatures().trackLayers,s=this.layerDataIds.trackLayers,o)?(l.forEach(function(t,e){l[e].propDatas.trackPoints=c.getTrackLayerDatas(s[e]);var n=c.layerDataCache(s[e],l[e].ref),r=o[e]&&o[e].features,r=r&&r.features&&r.features[0]&&r.features[0].properties,a=n.nextTimeStamp,i=n.playInterval,n=n.currentTimeStamp,r=(r=(r||{}).timestamp)&&+new Date(r);l[e].propDatas.position={prevTimestamp:r,currentTimestamp:n||r,nextTimestamp:a&&1e3*a,step:i}}),Object.freeze(l)):l},getTrackAllDatas:function(t){var t=this.$store.getters.getDataCache(t);if(t)return t="timeData"===t.type?t.timeDataId:t.data,g.a.$options.getData(t)},getTrackLayerDatas:function(t){var n=this.getTrackAllDatas(t);if(n){var e,r=[];for(e in n)!function(e){var t=n[e];t&&0<t.length&&0<(t=t.filter(function(t){return t.geometry&&"Point"===t.geometry.type}).map(function(t){return c(c({},t),{},{properties:c(c({},t.properties),{},{timestamp:1e3*e})})})).length&&r.push.apply(r,K(t))}(e);return Object.freeze(r)}},resetTrackLayers:function(t,e){var n=this,t=this.diffData(t,e);t&&Object.keys(t).forEach(function(t){n.currentProps.trackLayers&&n.currentProps.trackLayers[t]&&(t=n.currentProps.trackLayers[t].ref,t=n.$refs[t])&&t[0].reset()})}}},r=e("l6bU"),V=e("YQ51"),W=e("6G66"),l=e("bG4Z"),u=e("9ad+"),u=e.n(u),v=e("5zrt"),v=e.n(v),b=e("45Hi"),b=e.n(b),w=e("mSNy"),H=[{id:"tianditu_vec_3857",title:Object(w.e)().t("internetMap.tiandituVec3857"),thumbnail:b.a,sourceType:"TIANDITU",minzoom:0,maxzoom:22,url:"https://t{s}.tianditu.gov.cn/vec_w/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=w&format=tiles&width=256&height=256&layer=vec&tilematrix={z}&tilerow={y}&tilecol={x}",labelUrl:"https://t{s}.tianditu.gov.cn/cva_w/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=w&format=tiles&width=256&height=256&layer=cva&tilematrix={z}&tilerow={y}&tilecol={x}",epsgCode:"EPSG:3857",s:8},{id:"tianditu_ter_3857",title:Object(w.e)().t("internetMap.tiandituTer3857"),thumbnail:v.a,sourceType:"TIANDITU",minzoom:0,maxzoom:22,url:"https://t{s}.tianditu.gov.cn/ter_w/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=w&format=tiles&width=256&height=256&layer=ter&tilematrix={z}&tilerow={y}&tilecol={x}",labelUrl:"https://t{s}.tianditu.gov.cn/cta_w/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=w&format=tiles&width=256&height=256&layer=cta&tilematrix={z}&tilerow={y}&tilecol={x}",epsgCode:"EPSG:3857",s:8},{id:"tianditu_img_3857",title:Object(w.e)().t("internetMap.tiandituImg3857"),thumbnail:u.a,sourceType:"TIANDITU",minzoom:0,maxzoom:22,url:"https://t{s}.tianditu.gov.cn/img_w/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=w&format=tiles&width=256&height=256&layer=img&tilematrix={z}&tilerow={y}&tilecol={x}",labelUrl:"https://t{s}.tianditu.gov.cn/cia_w/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=w&format=tiles&width=256&height=256&layer=cia&tilematrix={z}&tilerow={y}&tilecol={x}",epsgCode:"EPSG:3857",s:8},{id:"tianditu_vec_4326",title:Object(w.e)().t("internetMap.tiandituVec4326"),thumbnail:b.a,sourceType:"TIANDITU",minzoom:0,maxzoom:22,url:"https://t{s}.tianditu.gov.cn/vec_c/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=c&format=tiles&width=256&height=256&layer=vec&tilematrix={z}&tilerow={y}&tilecol={x}",labelUrl:"https://t{s}.tianditu.gov.cn/cva_c/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=c&format=tiles&width=256&height=256&layer=cva&tilematrix={z}&tilerow={y}&tilecol={x}",epsgCode:"EPSG:4326",s:8},{id:"tianditu_ter_4326",title:Object(w.e)().t("internetMap.tiandituTer4326"),thumbnail:v.a,sourceType:"TIANDITU",minzoom:0,maxzoom:22,url:"https://t{s}.tianditu.gov.cn/ter_c/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=c&format=tiles&width=256&height=256&layer=ter&tilematrix={z}&tilerow={y}&tilecol={x}",labelUrl:"https://t{s}.tianditu.gov.cn/cta_c/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=c&format=tiles&width=256&height=256&layer=cta&tilematrix={z}&tilerow={y}&tilecol={x}",epsgCode:"EPSG:4326",s:8},{id:"tianditu_img_4326",title:Object(w.e)().t("internetMap.tiandituImg4326"),thumbnail:u.a,sourceType:"TIANDITU",minzoom:0,maxzoom:22,url:"https://t{s}.tianditu.gov.cn/img_c/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=c&format=tiles&width=256&height=256&layer=img&tilematrix={z}&tilerow={y}&tilecol={x}",labelUrl:"https://t{s}.tianditu.gov.cn/cia_c/wmts?tk={tk}&service=WMTS&request=GetTile&version=1.0.0&style=default&tilematrixSet=c&format=tiles&width=256&height=256&layer=cia&tilematrix={z}&tilerow={y}&tilecol={x}",epsgCode:"EPSG:4326",s:8}];function k(t){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Y(e,t){var n,r=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)),r}function Q(r){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(a),!0).forEach(function(t){var e,n;e=r,n=a[t=t],(t=tt(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):Y(Object(a)).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(a,t))})}return r}function D(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */D=function(){return o};var c,o={},t=Object.prototype,l=t.hasOwnProperty,u=Object.defineProperty||function(t,e,n){t[e]=n.value},e="function"==typeof Symbol?Symbol:{},r=e.iterator||"@@iterator",n=e.asyncIterator||"@@asyncIterator",a=e.toStringTag||"@@toStringTag";function i(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{i({},"")}catch(c){i=function(t,e,n){return t[e]=n}}function s(t,e,n,r){var a,i,o,s,e=e&&e.prototype instanceof g?e:g,e=Object.create(e.prototype),r=new M(r||[]);return u(e,"_invoke",{value:(a=t,i=n,o=r,s=f,function(t,e){if(s===d)throw new Error("Generator is already running");if(s===m){if("throw"===t)throw e;return{value:c,done:!0}}for(o.method=t,o.arg=e;;){var n=o.delegate;if(n){n=function t(e,n){var r=n.method,a=e.iterator[r];if(a===c)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=c,t(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;r=p(a,e.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,y;a=r.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=c),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}(n,o);if(n){if(n===y)continue;return n}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(s===f)throw s=m,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);s=d;n=p(a,i,o);if("normal"===n.type){if(s=o.done?m:h,n.arg===y)continue;return{value:n.arg,done:o.done}}"throw"===n.type&&(s=m,o.method="throw",o.arg=n.arg)}})}),e}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}o.wrap=s;var f="suspendedStart",h="suspendedYield",d="executing",m="completed",y={};function g(){}function v(){}function b(){}var e={},w=(i(e,r,function(){return this}),Object.getPrototypeOf),w=w&&w(w(P([]))),S=(w&&w!==t&&l.call(w,r)&&(e=w),b.prototype=g.prototype=Object.create(e));function O(t){["next","throw","return"].forEach(function(e){i(t,e,function(t){return this._invoke(e,t)})})}function I(o,s){var e;u(this,"_invoke",{value:function(n,r){function t(){return new s(function(t,e){!function e(t,n,r,a){var i,t=p(o[t],o,n);if("throw"!==t.type)return(n=(i=t.arg).value)&&"object"==k(n)&&l.call(n,"__await")?s.resolve(n.__await).then(function(t){e("next",t,r,a)},function(t){e("throw",t,r,a)}):s.resolve(n).then(function(t){i.value=t,r(i)},function(t){return e("throw",t,r,a)});a(t.arg)}(n,r,t,e)})}return e=e?e.then(t,t):t()}})}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function M(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function P(e){if(e||""===e){var n,t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return n=-1,(t=function t(){for(;++n<e.length;)if(l.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=c,t.done=!0,t}).next=t}throw new TypeError(k(e)+" is not iterable")}return u(S,"constructor",{value:v.prototype=b,configurable:!0}),u(b,"constructor",{value:v,configurable:!0}),v.displayName=i(b,a,"GeneratorFunction"),o.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},o.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,i(t,a,"GeneratorFunction")),t.prototype=Object.create(S),t},o.awrap=function(t){return{__await:t}},O(I.prototype),i(I.prototype,n,function(){return this}),o.AsyncIterator=I,o.async=function(t,e,n,r,a){void 0===a&&(a=Promise);var i=new I(s(t,e,n,r),a);return o.isGeneratorFunction(e)?i:i.next().then(function(t){return t.done?t.value:i.next()})},O(S),i(S,a,"Generator"),i(S,r,function(){return this}),i(S,"toString",function(){return"[object Generator]"}),o.keys=function(t){var e,n=Object(t),r=[];for(e in n)r.push(e);return r.reverse(),function t(){for(;r.length;){var e=r.pop();if(e in n)return t.value=e,t.done=!1,t}return t.done=!0,t}},o.values=P,M.prototype={constructor:M,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=c,this.done=!1,this.delegate=null,this.method="next",this.arg=c,this.tryEntries.forEach(C),!t)for(var e in this)"t"===e.charAt(0)&&l.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=c)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var r=this;function t(t,e){return i.type="throw",i.arg=n,r.next=t,e&&(r.method="next",r.arg=c),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var a=this.tryEntries[e],i=a.completion;if("root"===a.tryLoc)return t("end");if(a.tryLoc<=this.prev){var o=l.call(a,"catchLoc"),s=l.call(a,"finallyLoc");if(o&&s){if(this.prev<a.catchLoc)return t(a.catchLoc,!0);if(this.prev<a.finallyLoc)return t(a.finallyLoc)}else if(o){if(this.prev<a.catchLoc)return t(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return t(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&l.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}var i=(a=a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc?null:a)?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),C(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n,r,a=this.tryEntries[e];if(a.tryLoc===t)return"throw"===(n=a.completion).type&&(r=n.arg,C(a)),r}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:P(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=c),y}},o}function J(t,e,n,r,a,i,o){try{var s=t[i](o),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,a)}function Z(s){return function(){var t=this,o=arguments;return new Promise(function(e,n){var r=s.apply(t,o);function a(t){J(r,e,n,a,i,"next",t)}function i(t){J(r,e,n,a,i,"throw",t)}a(void 0)})}}function X(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,tt(r.key),r)}}function tt(t){t=function(t,e){if("object"!==k(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);n=n.call(t,e||"default");if("object"!==k(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"===k(t)?t:String(t)}function et(t,e){return(et=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function nt(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=S(n),e=(t=r?(t=S(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(t&&("object"===k(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function S(t){return(S=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var O=Object(d.j)(),rt=Object(d.l)(),at="".concat(O,"/web/static/portal/img/mapDashboard/defaultThumbnail.png"),it={Map:function(t,e,n){n.url=e?rt:O,n.withCredentials=!e},DrillMap:function(t,e,n){n.url=e?rt:O,n.withCredentials=!e},Dashboard:function(t,e,n){n.name&&(n.title=n.name),n.thumbnail||(n.thumbnail=at),n.url="".concat(O,"/web/mapdashboards/").concat(n.id,".json"),n.withCredentials=!0},Scene:function(t,e,n){n.name&&(n.title=n.name),n.url||(n.url="".concat(O,"/web/scenes/").concat(n.id)),n.withCredentials=!0}},ot={publicMap:!1,myMap:!0,publicDashboard:!1,myDashboard:!0,publicScene:!1,myScene:!0,online:!1},st=function(t){var e=o;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&et(e,t);var n,r,a,i=nt(o);function o(t){var e;if(this instanceof o)return(e=i.call(this)).url=t,e.getDrillMaps=l.b,e.getMaps=l.b,e.getDashboards=l.a,e.getScenes=l.c,e;throw new TypeError("Cannot call a class as a function")}return e=o,(t=[{key:"getResourceInfo",value:function(n,t,r,e,a,i){var o=this;this["get".concat(n,"s")]({params:t,isMyContent:r,permissionType:e,isOnline:a}).then(function(t){var e;t&&t.content&&(t.content.forEach(it[n].bind(o,r,a)),e=t.total?{current:t.currentPage,pageSize:t.pageSize,total:t.total}:null,o.fire("getresourceinfosucceeded",{result:t.content,activeKey:i,pagination:e}))})}},{key:"getResourceContent",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:20,a=4<arguments.length?arguments[4]:void 0,i={currentPage:n,pageSize:r},a=(a&&(i.keywords=encodeURIComponent(a)),ot[e]),o="READ",s=!1;if("internetMap"!==e&&"service"!==e){if("Template"===t){if("template"===e)return void this.getTemplates(i,e)}else"Dashboard"===t&&(o="ALL");this.getResourceInfo(t,i,a,o,s="online"===e?!0:s,e)}else"internetMap"===e&&this.fire("getresourceinfosucceeded",{result:H,activeKey:e,pagination:{total:H.length,current:n,pageSize:r}})}},{key:"getTemplates",value:(a=Z(D().mark(function t(e,n){var r,a,i,o,s;return D().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.currentPage,a=e.pageSize,i=(r-1)*a,t.next=4,this.initTemplates();case 4:this.templates=t.sent,o=this.templates.slice(i,i+a),s=this.templates.length,this.fire("getresourceinfosucceeded",{result:o,activeKey:n,pagination:s?{current:r,pageSize:a,total:s}:null});case 8:case"end":return t.stop()}},t,this)})),function(t,e){return a.apply(this,arguments)})},{key:"initTemplates",value:(r=Z(D().mark(function t(){var e;return D().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(d.o)();case 2:return e=t.sent,this.templates=e.map(function(t,e){return Q(Q({},t),{},{id:e+1,title:Object(w.e)().t("templatesName.".concat(t.name)),content:null})}),this.templates.unshift({content:{name:"empty"},id:0,thumbnail:"static/templates/img/empty.png",title:Object(w.e)().t("templatesName.newblankTemplate")}),t.abrupt("return",this.templates);case 6:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})}])&&X(e.prototype,t),n&&X(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(a.a.Evented),b=e("9/5/"),ct=e.n(b),v={name:"Input",model:{prop:"value",event:"change"},props:{type:{type:String,default:"text"},title:{type:String},placeholder:{type:String,default:function(){return this.$t("setting.common.input")}},value:{type:[String,Number]},input:{type:Function},wrap:{type:Boolean,default:!1},unit:{type:String},tips:{type:String},defaultValue:{type:Number,default:0},formatter:{type:Function},parser:{type:Function},max:{type:Number},min:{type:Number},precisionLimit:{type:Boolean,default:!0},precision:{type:Number,default:2},step:{type:Number,default:.5},decimalSeparator:{type:String,default:"."},disabled:{type:Boolean},icon:{type:Boolean,default:!1},iconClickCallback:{type:Function},iconTitle:String,colon:{type:Boolean,default:!1},useDebounce:{type:Boolean,default:!1},debounceTime:{type:Number,default:2e3}},computed:{precisionProps:function(){return this.precisionLimit?{precision:this.precision,step:this.step}:null}},created:function(){this.useDebounce&&(this.handleChangeFn=ct()(this.emitChange,this.debounceTime,{trailing:!0}))},methods:{handleInput:function(t){this.$emit("input",t.target.value),this.input&&this.input(t.target.value)},handleBlur:function(t){this.$emit("blur",t.target.value)},handleFocus:function(t){this.$emit("focus",t.target.value)},handleClick:function(t){this.$emit("click",t.target.value)},handlePressEnter:function(t){this.$emit("pressEnter",t.target.value)},emitChange:function(t){this.$emit("change",""===t?void 0:t)},handleChange:function(t){this.useDebounce?this.handleChangeFn(t):this.emitChange(t)}}},u=(e("mh0i"),e("KHd+")),b=Object(u.a)(v,function(){var e=this,t=e.$createElement,t=e._self._c||t;return t("div",{class:["sm-setting-panel",{"is-wrap":e.wrap}]},[e.title?t("div",{staticClass:"sm-setting-panel__header"},[e._v("\n    "+e._s(e.colon?e.title+"：":e.title)+"\n    "),e.iconClickCallback?[e.icon?t("i",{staticClass:"sm-mapdashboard-icon-circle-query",style:{"margin-left":"-4px","font-size":"12px",cursor:"pointer"},attrs:{title:e.iconTitle},on:{click:e.iconClickCallback}}):e._e()]:[t("a-popover",{attrs:{trigger:"hover",placement:"bottom"}},[t("template",{slot:"content"},[t("div",[e._t("iconTip")],2)]),e._v(" "),e.icon?t("i",{staticClass:"sm-mapdashboard-icon-circle-query",style:{"margin-left":"-3px","font-size":"12px"},attrs:{title:e.iconTitle}}):e._e()],2)]],2):e._e(),e._v(" "),t("div",{staticClass:"sm-setting-panel__content",attrs:{title:e.tips}},["textArea"===e.type?t("sm-textarea",{attrs:{value:e.value,placeholder:e.placeholder},on:{input:e.handleInput,change:function(t){return e.handleChange(t.target.value)}}}):e._e(),e._v(" "),"text"===e.type?t("sm-input",{attrs:{value:e.value,placeholder:e.placeholder,disabled:e.disabled},on:{input:e.handleInput,blur:e.handleBlur,focus:e.handleFocus,click:e.handleClick,pressEnter:e.handlePressEnter,change:function(t){return e.handleChange(t.target.value)}}}):e._e(),e._v(" "),"number"===e.type?t("div",{class:{"input-number-holder":!0,"unit-gap":!!e.unit}},[t("sm-input-number",e._b({attrs:{value:e.value,placeholder:e.placeholder,formatter:e.formatter,defaultValue:e.defaultValue,parser:e.parser,max:e.max,min:e.min},on:{input:e.handleInput,blur:e.handleBlur,change:function(t){return e.handleChange(t)}}},"sm-input-number",e.precisionProps,!1)),e._v(" "),e.unit?t("span",{staticClass:"sm-setting-unit"},[e._v(e._s(e.unit))]):e._e()],1):e._e()],1)])},[],!1,null,null,null).exports,v={name:"SwitchElement",model:{prop:"value",event:"change"},props:{title:{type:String},value:{type:Boolean},wrap:{type:Boolean,default:!1},icon:{type:Boolean,default:!1},colon:{type:Boolean,default:!1}},data:function(){return{switchVal:!1}},watch:{value:function(){this.switchVal=this.value}},mounted:function(){this.switchVal=this.value},methods:{handleChange:function(t){this.$emit("change",t)}}},v=Object(u.a)(v,function(){var e=this,t=e.$createElement,t=e._self._c||t;return t("div",{class:["sm-setting-panel",{"is-wrap":e.wrap}]},[e.title?t("div",{staticClass:"sm-setting-panel__header"},[e._v("\n    "+e._s(e.colon?e.title+"：":e.title)+"\n    "),t("a-popover",{attrs:{trigger:"hover",placement:"bottom","get-popup-container":function(t){return t.parentNode}}},[t("template",{slot:"content"},[t("div",[e._t("iconTip")],2)]),e._v(" "),e.icon?t("i",{staticClass:"sm-mapdashboard-icon-circle-query",style:{"margin-left":"-2px","font-size":"12px"}}):e._e()],2)],1):e._e(),e._v(" "),t("div",{staticClass:"sm-setting-panel__content"},[t("sm-switch",{attrs:{size:"small"},on:{change:e.handleChange},model:{value:e.switchVal,callback:function(t){e.switchVal=t},expression:"switchVal"}})],1)])},[],!1,null,null,null).exports,lt=e("GSdF"),I={name:"SmSettingTdtKey",components:{InputElement:b},props:{wrap:{type:Boolean,default:!0},resourceStyle:{type:Boolean,default:!1}},data:function(){return{tiandituToken:""}},watch:{"$store.getters.tdtKey":{handler:function(t){this.tiandituToken=this.$store.getters.tdtKey,this.checkKey(this.tiandituToken)},immediate:!0}},created:function(){var t=this;this.debounceFn=lt.b.debounce(function(){t.$store.dispatch("SET_TDT_TOKEN",t.tiandituToken)},1e3)},methods:{changeKey:function(){this.debounceFn()},checkKey:function(t){this.$emit("correctTdtKeyFn",t)}}},I=(e("0m1j"),Object(u.a)(I,function(){var e=this,t=e.$createElement,t=e._self._c||t;return t("div",{class:["sm-setting-tdt-key",e.resourceStyle?"sm-setting-resource":""]},[t("InputElement",{attrs:{wrap:e.wrap,icon:!0,title:e.$t("setting.webMap.key")},on:{change:e.changeKey},model:{value:e.tiandituToken,callback:function(t){e.tiandituToken=t},expression:"tiandituToken"}},[t("span",{attrs:{slot:"iconTip"},slot:"iconTip"},[t("a",{attrs:{target:"_blank",rel:"noopener noreferrer",href:"http://lbs.tianditu.gov.cn/authorization/authorization.html"}},[e._v(e._s(e.$t("setting.webMap.keyInfo")))])])])],1)},[],!1,null,"436f1d25",null).exports),ut=e("tWJv"),T=e("KqOx"),pt=e("p5/s"),C=e("US+v"),ft=e.n(C);function j(t){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function E(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */E=function(){return o};var c,o={},t=Object.prototype,l=t.hasOwnProperty,u=Object.defineProperty||function(t,e,n){t[e]=n.value},e="function"==typeof Symbol?Symbol:{},r=e.iterator||"@@iterator",n=e.asyncIterator||"@@asyncIterator",a=e.toStringTag||"@@toStringTag";function i(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{i({},"")}catch(c){i=function(t,e,n){return t[e]=n}}function s(t,e,n,r){var a,i,o,s,e=e&&e.prototype instanceof g?e:g,e=Object.create(e.prototype),r=new M(r||[]);return u(e,"_invoke",{value:(a=t,i=n,o=r,s=f,function(t,e){if(s===d)throw new Error("Generator is already running");if(s===m){if("throw"===t)throw e;return{value:c,done:!0}}for(o.method=t,o.arg=e;;){var n=o.delegate;if(n){n=function t(e,n){var r=n.method,a=e.iterator[r];if(a===c)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=c,t(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;r=p(a,e.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,y;a=r.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=c),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}(n,o);if(n){if(n===y)continue;return n}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(s===f)throw s=m,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);s=d;n=p(a,i,o);if("normal"===n.type){if(s=o.done?m:h,n.arg===y)continue;return{value:n.arg,done:o.done}}"throw"===n.type&&(s=m,o.method="throw",o.arg=n.arg)}})}),e}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}o.wrap=s;var f="suspendedStart",h="suspendedYield",d="executing",m="completed",y={};function g(){}function v(){}function b(){}var e={},w=(i(e,r,function(){return this}),Object.getPrototypeOf),w=w&&w(w(P([]))),S=(w&&w!==t&&l.call(w,r)&&(e=w),b.prototype=g.prototype=Object.create(e));function O(t){["next","throw","return"].forEach(function(e){i(t,e,function(t){return this._invoke(e,t)})})}function I(o,s){var e;u(this,"_invoke",{value:function(n,r){function t(){return new s(function(t,e){!function e(t,n,r,a){var i,t=p(o[t],o,n);if("throw"!==t.type)return(n=(i=t.arg).value)&&"object"==j(n)&&l.call(n,"__await")?s.resolve(n.__await).then(function(t){e("next",t,r,a)},function(t){e("throw",t,r,a)}):s.resolve(n).then(function(t){i.value=t,r(i)},function(t){return e("throw",t,r,a)});a(t.arg)}(n,r,t,e)})}return e=e?e.then(t,t):t()}})}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function M(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function P(e){if(e||""===e){var n,t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return n=-1,(t=function t(){for(;++n<e.length;)if(l.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=c,t.done=!0,t}).next=t}throw new TypeError(j(e)+" is not iterable")}return u(S,"constructor",{value:v.prototype=b,configurable:!0}),u(b,"constructor",{value:v,configurable:!0}),v.displayName=i(b,a,"GeneratorFunction"),o.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},o.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,i(t,a,"GeneratorFunction")),t.prototype=Object.create(S),t},o.awrap=function(t){return{__await:t}},O(I.prototype),i(I.prototype,n,function(){return this}),o.AsyncIterator=I,o.async=function(t,e,n,r,a){void 0===a&&(a=Promise);var i=new I(s(t,e,n,r),a);return o.isGeneratorFunction(e)?i:i.next().then(function(t){return t.done?t.value:i.next()})},O(S),i(S,a,"Generator"),i(S,r,function(){return this}),i(S,"toString",function(){return"[object Generator]"}),o.keys=function(t){var e,n=Object(t),r=[];for(e in n)r.push(e);return r.reverse(),function t(){for(;r.length;){var e=r.pop();if(e in n)return t.value=e,t.done=!1,t}return t.done=!0,t}},o.values=P,M.prototype={constructor:M,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=c,this.done=!1,this.delegate=null,this.method="next",this.arg=c,this.tryEntries.forEach(C),!t)for(var e in this)"t"===e.charAt(0)&&l.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=c)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var r=this;function t(t,e){return i.type="throw",i.arg=n,r.next=t,e&&(r.method="next",r.arg=c),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var a=this.tryEntries[e],i=a.completion;if("root"===a.tryLoc)return t("end");if(a.tryLoc<=this.prev){var o=l.call(a,"catchLoc"),s=l.call(a,"finallyLoc");if(o&&s){if(this.prev<a.catchLoc)return t(a.catchLoc,!0);if(this.prev<a.finallyLoc)return t(a.finallyLoc)}else if(o){if(this.prev<a.catchLoc)return t(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return t(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&l.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}var i=(a=a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc?null:a)?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),C(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n,r,a=this.tryEntries[e];if(a.tryLoc===t)return"throw"===(n=a.completion).type&&(r=n.arg,C(a)),r}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:P(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=c),y}},o}function ht(t,e,n,r,a,i,o){try{var s=t[i](o),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,a)}var C={name:"SmResourceSelector",components:{InputElement:b,SwitchElement:v,"sm-setting-tdt-token":I},props:{dialogVisible:{type:Boolean,default:!1},useType:{type:String,default:"Map"},selectId:{type:[String,Number]},defaultSelectId:{type:[String,Number]},proxy:{type:Boolean,default:!1},filter:{type:Function}},data:function(){var t=this.$createElement;return{emptyPng:ft.a,activeName:"",visible:!1,title:this.$t("setting.webMap.selectMap"),pagination:null,searchKey:null,cacheParam:{},resourceInfo:null,tiandituToken:"",correctKey:!1,allTabs:{Dashboard:[{key:"publicDashboard",name:this.$t("setting.dashboardSwitch.publicMD")},{key:"myDashboard",name:this.$t("setting.dashboardSwitch.myMD")}],Map:[{key:"publicMap",name:this.$t("setting.webMap.publicMap")},{key:"myMap",name:this.$t("setting.webMap.myMap")},{key:"internetMap",name:this.$t("setting.webMap.internetMap")},{key:"service",name:this.$t("setting.webMap.service")}],DrillMap:[{key:"publicMap",name:this.$t("setting.webMap.publicMap")},{key:"myMap",name:this.$t("setting.webMap.myMap")}],Scene:[{key:"publicScene",name:this.$t("setting.webScene.publicScene")},{key:"myScene",name:this.$t("setting.webScene.myScene")}],Template:[{key:"template",name:this.$t("templatesName.template")},{key:"publicDashboard",name:this.$t("setting.dashboardSwitch.publicMD")},{key:"myDashboard",name:this.$t("setting.dashboardSwitch.myMD")}]},crossAgent:this.proxy,loading:!0,indicator:t("div",{style:"width:100%;height:100%",class:"lds-flickr small"},[t("div"),t("div"),t("div")])}},computed:{disableComfirmBtn:function(){return!this.cacheParam[this.activeName]&&!this.isIServerMap||this.isIServerMap&&!this.serviceUrlRight},serviceUrlRight:function(){return Object(d.a)(this.cacheParam[this.activeName])},currentSelectType:function(){return this.allTabs[this.useType]},isInternetMap:function(){return"internetMap"===this.activeName},isIServerMap:function(){return"service"===this.activeName},filterResourceInfo:function(){var e=this;return this.resourceInfo?this.resourceInfo.map(function(t){return t.notAllowedTip="",t.notAllowed=!1,"TIANDITU"!==t.sourceType||e.correctKey||(t.notAllowedTip+=e.$t("setting.webMap.configKey"),t.notAllowed=!0),t.id===e.selectId&&(t.notAllowedTip+=e.$t("setting.webMap.notAllowedSelectSameMap"),t.notAllowed=!0),e.filter&&e.filter(t)&&(t.notAllowedTip+=e.$t("setting.webMap.notMatchCurrentProjection"),t.notAllowed=!0),t}):[]},isEmptyTemplate:function(){return function(t){return t.content&&"empty"===t.content.name}},lockPublicDashboard:function(){var e=this;return function(t){return!("Template"!==e.useType||"publicDashboard"!==e.activeName||"READWRITE"===e.dashboardAuthorize(t)||"DELETE"===e.dashboardAuthorize(t))}},disableAddNew:function(){return this.$store.getters.disableAddNew},isEmpty:function(){return"service"!==this.activeName&&"internetMap"!==this.activeName&&!this.loading&&0===this.filterResourceInfo.length}},watch:{dialogVisible:function(){this.getDatas(),this.visible=this.dialogVisible,this.dialogVisible&&(this.activeName=this.lastModifyActiveName||this.activeName)},visible:function(){!1===this.visible&&(this.$emit("dialogvisible",!1),this.clearData())},activeName:function(){this.pagination=null,this.searchKey=null,this.resourceInfo=null,this.getDatas()},"$store.getters.tdtKey":{handler:function(t){this.tiandituToken=t},immediate:!0},disableAddNew:function(){this.disableAddNew&&this.$set(this.cacheParam,this.activeName,null)}},created:function(){Object(d.q)()||(this.allTabs.Map.splice(2,0,{key:"online",name:this.$t("setting.webMap.onlineMap")}),this.allTabs.DrillMap.splice(2,0,{key:"online",name:this.$t("setting.webMap.onlineMap")}))},beforeMount:function(){this.$store.dispatch("CHANGE_SELECT_MODAL_VISIBLE",!0)},beforeDestroy:function(){this.$store.dispatch("CHANGE_SELECT_MODAL_VISIBLE",!1)},mounted:function(){this.url=Object(d.j)(),this.viewModel=new st(this.url),this.registerEvents(),this.init()},methods:{init:function(){var e=this;this.title={DrillMap:this.$t("setting.webMap.selectMap"),Map:this.$t("setting.webMap.selectMap"),Dashboard:this.$t("setting.dashboardSwitch.selectMD"),Template:this.$t("setting.dashboardSwitch.selectMD"),Scene:this.$t("setting.webScene.selectScene")}[this.useType],this.activeName=this.currentSelectType[0].key,this.dialogVisible&&this.getDatas(),this.viewModel.on("getresourceinfosucceeded",function(t){"Template"===e.useType&&e.resourceInfoClicked(null,e.resourceInfo[e.defaultSelectId])})},refresh:function(){this.resourceInfo=[],this.getDatas()},getDatas:function(t,e){var n;this.loading=!0,this.dialogVisible&&(n=this.searchKey&&JSON.stringify([this.searchKey]),this.viewModel.getResourceContent(this.useType,this.activeName,t,e,n))},getEpsgCodeWKT:function(t,e){if(t)return SuperMap.FetchRequest.get(t,null,e).then(function(t){return t.text()}).then(function(t){return t}).catch(function(t){console.log(t)})},onOk:function(){var s,h=this;return s=E().mark(function t(){var e,n,r,a,i,o,s,c,l,u,p,f;return E().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:h.lastModifyActiveName=h.activeName,e=m()(h.cacheParam[h.activeName]),-1===h.useType.indexOf("Map")?t.next=39:h.isInternetMap?(t.t0=e.sourceType,t.next="TIANDITU"===t.t0?7:9):t.next=14;break;case 7:return n=h.createTilesInfo(e,h.tiandituToken),t.abrupt("break",10);case 9:return t.abrupt("break",10);case 10:e.mapOptions=h.createInternetMapInfo(n),e.url="",t.next=37;break;case 14:if(h.isIServerMap)return a=(r=e).split("/"),a=a[a.length-1],t.next=20,Object(ut.g)(r);t.next=36;break;case 20:return i=t.sent,t.next=23,h.getiServerMapInfo(r,i);case 23:if(p=t.sent)return c=p.prjCoordSys,o=p.bounds,s=p.center,c=c.epsgCode,l="EPSG:".concat(c),u=l,t.next=31,h.getEpsgCodeWKT("".concat(r,"/prjCoordSys.wkt"),{withoutFormatSuffix:!0});t.next=34;break;case 31:p=t.sent,f=Object(T.h)(l,p,o),e={url:r,title:a,withCredentials:i,mapOptions:{center:h.getMapCenter(s,u,p),crs:f,style:{version:8,sources:{"iserver-tiles":{type:"raster",tiles:[r],tileSize:256,prjCoordSys:c<0?"":{epsgCode:c},rasterSource:"iserver",proxy:h.crossAgent?Object(d.m)("image"):null}},layers:[{id:"simple-tiles",type:"raster",source:"iserver-tiles",minzoom:0,maxzoom:22}]}}};case 34:t.next=37;break;case 36:"online"!==h.activeName&&(e.proxy=h.crossAgent);case 37:f={serverUrl:h.isInternetMap||h.isIServerMap?null:e.url,mapId:h.isInternetMap||h.isIServerMap?null:e.id,mapOptions:e.mapOptions,withCredentials:e.withCredentials},Object(y.f)(f);case 39:h.$emit("resourceinfoclicked",{resourceParam:e,activeName:h.activeName}),h.isIServerMap||h.$emit("changeselectid",e.id),h.closeDialog();case 42:case"end":return t.stop()}},t)}),function(){var t=this,o=arguments;return new Promise(function(e,n){var r=s.apply(t,o);function a(t){ht(r,e,n,a,i,"next",t)}function i(t){ht(r,e,n,a,i,"throw",t)}a(void 0)})}()},getiServerMapInfo:function(t){var n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return new Promise(function(e){new a.a.supermap.MapService(t,{withCredentials:n}).getMapInfo(function(t){e((t||{}).result)})})},_unproject:function(t,e,n){return"EPSG:4326"===e?t:(n&&pt.a.defs(e,n),Object(pt.a)(e,"EPSG:4326",t))},getMapCenter:function(t,e,n){t=(t=t&&[t.x,t.y])||[0,0];return t=this._unproject(t,e,n)},createTilesInfo:function(t,e){for(var n=[],r=[],a=[],i=0;i<t.s;i++)r.push(t.url.replace("{tk}",e).replace("{s}",i)),t.withLabel&&a.push(t.labelUrl.replace("{tk}",e).replace("{s}",i));return n.push({url:r,id:t.id}),t.withLabel&&n.push({url:a,id:t.id+"_label"}),t.mapInfo=n,t},createInternetMapInfo:function(t){var e={},n=[];return t.mapInfo.forEach(function(t){e[t.id]={type:"raster",tiles:t.url,tileSize:256},n.push({id:t.id,type:"raster",source:t.id})}),{crs:t.epsgCode,minzoom:t.minzoom||0,maxzoom:t.maxzoom||22,style:{version:8,sources:e,layers:n},renderWorldCopies:!1}},closeDialog:function(){this.$emit("dialogvisible",!1)},registerEvents:function(){var e=this;this.viewModel.on("getresourceinfosucceeded",function(t){e.$nextTick(function(){e.loading=!1}),t.activeKey===e.activeName&&(e.resourceInfo=t.result,e.pagination=t.pagination,e.isInternetMap&&e.resourceInfo.forEach(function(t){"TIANDITU"===t.sourceType&&t.labelUrl&&(t.withLabel=!0)}),e.hasDatas(e.resourceInfo))})},hasDatas:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=this.cacheParam[this.activeName],t=t.find(function(t){return e&&t.id===e.id});e&&!t&&(this.cacheParam[this.activeName]=null)},resourceInfoClicked:function(t,e,n){e&&e.content&&"empty"===e.content.name&&this.disableAddNew||e&&e.notAllowed||n||this.$set(this.cacheParam,this.activeName,e)},clearData:function(){if(this.lastModifyActiveName)for(var t in this.cacheParam)t!==this.lastModifyActiveName&&this.cacheParam[t]&&(this.cacheParam[t]=null)},correctTdtKeyFn:function(t,e){this.correctKey=t},setCrossAgent:function(t){this.crossAgent=t.target.checked},dashboardAuthorize:function(t){var e,n=this.$store.getters.userName;t=t||[];for(var r=0;r<t.length;r++){var a=t[r];if(a.aliasName===n){e=a.permissionType;break}"GUEST"===a.aliasName&&(e=a.permissionType)}return e},changeUrl:function(){this.serviceUrlRight||this.$message.warning(this.$t("warning.enterUrl"),3)},isMultiPage:function(t){var t=(null==t?void 0:t.content)&&JSON.parse(t.content);return 1<(null==t||null==(t=t.pages)?void 0:t.length)},handlePginationChange:function(t,e){this.getDatas(t,e),document.querySelector(".sm-resource-selector").scrollTop=0}}},b=(e("jFi5"),e("9N6+"),Object(u.a)(C,function(){var r=this,t=r.$createElement,a=r._self._c||t;return a("sm-modal",{attrs:{dialogStyle:{"max-width":"1152px"},width:"auto",closable:!0,"lock-scroll":!1,maskClosable:!1,title:r.useType.includes("Map")?""+r.$t("setting.common.selectMap"):""+r.$t("setting.common.selectDashboard"),wrapClassName:"sm-resource-selector sm-setting-selector",dialogClass:"sm-resource-selector-modal sm-setting-selector-modal"},on:{cancel:r.closeDialog},model:{value:r.visible,callback:function(t){r.visible=t},expression:"visible"}},[a("sm-tabs",{attrs:{animated:!1},model:{value:r.activeName,callback:function(t){r.activeName=t},expression:"activeName"}},r._l(r.currentSelectType,function(t){return a("sm-tab-pane",{key:t.key,attrs:{tab:t.name,name:t.key}},[a("div",{class:["sm-resource-selector__resource-info",!r.useType.includes("Map")&&"sm-resource-selector__info"]},[["publicMap","myMap","publicDashboard","myDashboard","online"].includes(t.key)?a("div",{staticClass:"sm-resource-selector_update"},[a("sm-button",{staticClass:"sm-mapdashboard-icon",attrs:{size:"small"},on:{click:function(t){return r.refresh()}}},[a("i",{staticClass:"sm-mapdashboard-icon-refresh1"})]),r._v(" "),["publicMap","myMap"].includes(t.key)?a("span",{staticClass:"cross-agent-holder"},[a("sm-checkbox",{attrs:{checked:r.crossAgent},on:{change:r.setCrossAgent}},[r._v("\n              "+r._s(r.$t("setting.common.proxy"))+"\n              "),a("a-popover",{attrs:{placement:"right","arrow-point-at-center":"",getPopupContainer:function(t){return t.parentNode}}},[a("template",{slot:"content"},[a("span",[r._v(r._s(r.$t("setting.common.crossAgent")))])]),r._v(" "),a("i",{staticClass:"sm-mapdashboard-icon-circle-query"})],2)],1)],1):r._e(),r._v(" "),a("div",{staticClass:"search-holder"},[a("sm-input-search",{staticStyle:{width:"270px"},attrs:{placeholder:r.$t("setting.common.searchByKeyWords")},on:{search:function(t){return r.getDatas(1)}},model:{value:r.searchKey,callback:function(t){r.searchKey=t},expression:"searchKey"}}),r._v(" "),a("i",{staticClass:"sm-mapdashboard-icon-search",on:{click:function(t){return r.getDatas(1)}}})],1)],1):"internetMap"===t.key?a("div",{staticClass:"tdt-token"},[a("sm-setting-tdt-token",{attrs:{wrap:!1,resourceStyle:!0},on:{correctTdtKeyFn:r.correctTdtKeyFn}})],1):r._e(),r._v(" "),"service"!==r.activeName?a("a-row",{style:{opacity:r.loading?.25:1},attrs:{type:"flex",justify:"start"}},[r.filterResourceInfo.length?r._l(r.filterResourceInfo,function(e,n){return a("a-col",{key:n,attrs:{span:6,title:e.notAllowedTip}},[a("sm-card",{class:{clicked:r.cacheParam[r.activeName]&&e.id===r.cacheParam[r.activeName].id},style:{cursor:e.notAllowed?"not-allowed":"",opacity:e.notAllowed?.25:1},nativeOn:{click:function(t){r.resourceInfoClicked(t,e,r.lockPublicDashboard(e.authorizeSetting))}}},[a("template",{slot:"cover"},[r.isMultiPage(e)?a("div",{staticClass:"sm-multipages-icon",attrs:{title:r.$t("Pages.multiPage")}},[a("i",{staticClass:"sm-mapdashboard-icon-page-fill"})]):r._e(),r._v(" "),r.isEmptyTemplate(e)?r._e():a("img",{attrs:{alt:e.title,src:e.thumbnail}}),r._v(" "),e.labelUrl?a("div",{staticClass:"internetMap-lebel"},[a("SwitchElement",{attrs:{title:r.$t("setting.common.label")},model:{value:r.resourceInfo[n].withLabel,callback:function(t){r.$set(r.resourceInfo[n],"withLabel",t)},expression:"resourceInfo[index].withLabel"}})],1):r._e()]),r._v(" "),r.lockPublicDashboard(e.authorizeSetting)||r.isEmptyTemplate(e)?a("div",{staticClass:"sm-template-mongolia",style:{cursor:r.disableAddNew?"not-allowed":"pointer"},attrs:{slot:"cover",title:r.disableAddNew?r.$t("permissionModal.quotaOversizeAndCantAddNew"):e.title},slot:"cover"},[a("i",{class:r.isEmptyTemplate(e)?"sm-mapdashboard-icon-plus":"sm-mapdashboard-icon-lock",style:{fontSize:r.isEmptyTemplate(e)?"40px":"30px"},attrs:{type:r.isEmptyTemplate(e)?"plus":"lock"}})]):r._e(),r._v(" "),a("sm-card-meta",[a("span",{attrs:{slot:"title",title:e.title},slot:"title"},[r._v(r._s(e.title))])])],2)],1)}):r._e(),r._v(" "),r.isEmpty?a("div",{staticClass:"empty-tip"},[a("sm-empty",{attrs:{image:r.emptyPng}})],1):r._e()],2):a("div",{staticClass:"sm-resource-selector__my-service"},[a("div",{staticClass:"url-input"},[a("span",[r._v("URL：")]),r._v(" "),a("input-element",{attrs:{placeholder:r.$t("setting.common.matchIServerUrl"),useDebounce:!0,debounceTime:500},on:{change:r.changeUrl},model:{value:r.cacheParam[r.activeName],callback:function(t){r.$set(r.cacheParam,r.activeName,t)},expression:"cacheParam[activeName]"}})],1),r._v(" "),a("div",{staticClass:"cross-agent-holder"},[a("sm-checkbox",{attrs:{checked:r.crossAgent},on:{change:r.setCrossAgent}},[r._v("\n              "+r._s(r.$t("setting.common.proxy"))+"\n              "),a("a-popover",{attrs:{placement:"right","arrow-point-at-center":"",getPopupContainer:function(t){return t.parentNode}}},[a("template",{slot:"content"},[a("span",{staticStyle:{padding:"2px 6px"}},[r._v(r._s(r.$t("setting.common.crossAgent")))])]),r._v(" "),a("i",{staticClass:"sm-mapdashboard-icon-circle-query"})],2)],1)],1),r._v(" "),a("div",{staticClass:"example-holder"},[a("div",[a("h3",[r._v(r._s(r.$t("setting.common.iServerRestMapUrl"))+"：")]),r._v(" "),a("p",[r._v("http://{server}:{port}/iserver/services/{component}/rest/maps/{mapName}")])])])]),r._v(" "),r.loading&&"internetMap"!==r.activeName&&"service"!==r.activeName?a("sm-spin",{staticClass:"sm-content-loading",attrs:{indicator:r.indicator}}):r._e()],1)])}),1),r._v(" "),a("div",{staticClass:"toolbar-holder"},[r.pagination?a("sm-pagination",{staticClass:"pagination",attrs:{pageSize:r.pagination.pageSize,total:r.pagination.total},on:{change:r.handlePginationChange},model:{value:r.pagination.current,callback:function(t){r.$set(r.pagination,"current",t)},expression:"pagination.current"}}):r._e()],1),r._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("sm-button",{on:{click:r.closeDialog}},[r._v(r._s(r.$t("setting.common.cancel")))]),r._v(" "),a("sm-button",{attrs:{type:"primary",disabled:r.disableComfirmBtn},on:{click:r.onOk}},[r._v(r._s(r.$t("setting.common.add")))])],1)],1)},[],!1,null,"8a1b4b9a",null).exports),M=e("QNBb"),dt=e("Lb6U"),mt=e("7L49"),v=e("XaGS"),P=e.n(v);function L(t){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function yt(e,t){var n,r=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)),r}function gt(r){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?yt(Object(a),!0).forEach(function(t){var e,n;e=r,n=a[t=t],(t=function(t){t=function(t,e){if("object"!==L(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);n=n.call(t,e||"default");if("object"!==L(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"===L(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):yt(Object(a)).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(a,t))})}return r}I={props:{mapInfoList:{type:Object},mapStatus:{type:Array},dataCacheName:{type:String},propDatas:Object,activeKey:[String,Number]},data:function(){return{targetData:this.propDatas.target,readyNext:!0}},computed:{allLoaded:function(){return!(!this.mapStatus||!this.mapStatus.length)&&this.mapStatus.every(function(t){return t.status})}},watch:{mapInfoList:function(t,e){var n=this;!P()(t,e)&&this.map&&(t=Object.keys(this.viewModelList),Object.keys(this.mapInfoList).length>t.length&&(!e||JSON.stringify("{}"===e))?Object.keys(this.mapInfoList).forEach(function(t){n.viewModelList[t]||n.addMap(t,n.mapInfoList[t])}):(t.forEach(function(t){n.viewModelList[t].vm.cleanLayers(),n.viewModelList[t]=null}),this.viewModelList={},this.addMaps()))},activeKey:function(t,e){P()(t,e)||this.setActiveMap(t,e)}},created:function(){this.viewModelList={},this.mapQueue=[],this.map=null},beforeDestroy:function(){this.map&&this.map.off("zoomend",this.resetMapLoadStatus)},methods:{addMap:function(t,e){var i,o=this,n=(Object.keys(this.viewModelList).length||this.hideExistedLayers(),e.id),r=e.url,a=e.withCredentials,s=this.propDatas,c=s.target,l=s.tiandituKey,u=s.googleMapsAPIKey,p=s.googleMapsLanguage,s=s.mapOptions.rasterTileSize;this.viewModelList[t]||(this.readyNext?(i=new mt.a(n,{serverUrl:r,withCredentials:a,target:c,tiandituKey:l,googleMapsAPIKey:u,googleMapsLanguage:p,checkSameLayer:!0},{rasterTileSize:s},this.map),this.readyNext=!1,i.on({addlayerssucceeded:function(t){var e,n,r,a;o.readyNext=!0,i.setLayersVisible(!1),o.mapQueue.length?(e=(a=o.mapQueue.shift()).id,n=a.url,r=a.withCredentials,a=a.key,o.addMap(a,{id:e,url:n,withCredentials:r})):o.setActiveMap(o.activeKey,null)}}),this.viewModelList[t]={id:n,vm:i}):this.mapQueue.push(gt(gt({},e),{},{key:t})))},addMaps:function(){var e=this;Object.keys(this.mapInfoList).length&&Object.keys(this.mapInfoList).forEach(function(t){e.addMap(t,e.mapInfoList[t])})},setActiveMap:function(t,e){var n;this.viewModelList[t]&&t&&t!==e&&!this.timer&&(this.viewModelList[t]&&this.viewModelList[t].vm.setLayersVisible(!0),n=this.viewModelList[t].vm._cacheLayerId,this.allLoaded||this.isAllSourceLoaded(t,n),e)&&this.viewModelList[e]&&this.viewModelList[e].vm.setLayersVisible(!1,n)},isAllSourceLoaded:function(e,n){var r=this;this.timer&&(clearInterval(this.timer),this.timer=null),this.timer=setInterval(function(){var t;r.$emit("loadingChange",!0),n.every(function(t){return!r.map||!r.map.style||!r.map.getSource(t)||r.map.isSourceLoaded(t)})&&r.mapStatus&&(clearInterval(r.timer),r.timer=null,(t=r.mapStatus.concat()).forEach(function(t){t.key===e&&(t.status=!0)}),r.$store.dispatch("UPDATE_DATA_INFO",{uuid:r.dataCacheName,dataInfo:{mapStatus:t}}),r.$emit("loadingChange",!1))},100)},setMap:function(t){this.map=t,this.addMaps(),this.resetMapLoadStatus(),this.map.on("zoomend",this.resetMapLoadStatus)},hideExistedLayers:function(){var e=this;this.map&&this.map.getStyle().layers.forEach(function(t){e.map.setLayoutProperty(t.id,"visibility","none")})},resetMapLoadStatus:function(){var e,t;this.mapStatus&&this.mapStatus.length?e=this.mapStatus.map(function(t){return t.status=!1,t}):(t=Object.keys(this.mapInfoList)).length&&(e=[],t.forEach(function(t){e.push({key:t,status:!1})})),e&&e.length&&(this.$store.dispatch("UPDATE_DATA_INFO",{uuid:this.dataCacheName,dataInfo:{mapStatus:e}}),this.setActiveMap(this.activeKey,null))}},render:function(){return null}},C=Object(u.a)(I,void 0,void 0,!1,null,null,null).exports;function _(t){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function vt(e,t){var n,r=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)),r}function x(r){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?vt(Object(a),!0).forEach(function(t){var e,n;e=r,n=a[t=t],(t=function(t){t=function(t,e){if("object"!==_(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);n=n.call(t,e||"default");if("object"!==_(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"===_(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):vt(Object(a)).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(a,t))})}return r}function bt(t){return function(t){if(Array.isArray(t))return A(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){var n;if(t)return"string"==typeof t?A(t,e):"Map"===(n="Object"===(n=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A(t,e):void 0}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var wt={beforehorizontal:{top:"25%",left:"50%"},beforevertical:{top:"50%",left:"25%"},afterhorizontal:{top:"75%",left:"50%"},aftervertical:{top:"50%",left:"75%"}},v={components:{"sm-resource-selector":b,"sm-table-popup":n.a,"map-manager":C},mixins:[$,r.a,V.a,W.a],props:{pageId:{type:String},component:{type:Object,required:!0},defaultParams:{type:Object},updateComponentName:{type:Boolean,default:!0},allowEpsgCode:{type:String}},data:function(){return{componentId:null,dialogVisible:!1,isCreateDialog:!1,childrenList:[],mapInfoList:{},mapCacheInfo:{},dataCacheName:"",activeKey:"",loading:!1,eventList:[],tablePopupProps:{columns:[{title:this.$t("query.attribute"),dataIndex:"attribute",width:80},{title:this.$t("query.attributeValue"),dataIndex:"attributeValue",width:150}],data:[]},filterActionData:{},uuid:""}},computed:{validMap:function(){var t,e;return!!this.mergeDefaultParams&&!!(this.mergeDefaultParams.mapId&&this.mergeDefaultParams.serverUrl||(e=(t=this.mergeDefaultParams.mapOptions.style).layers,t=t.sources,e&&t&&0<e.length&&0<Object.keys(t).length)||Object.keys(this.mapInfoList).length||(e=this.mergeDefaultParams.data,this.isDrillMap&&e[0]&&e[0].mapId&&e[0].serverUrl))},compareMapBtnStyle:function(){var t=this.defaultParams.props,e=t.orientation,t=t.target;return e?-1===t.indexOf("before")&&-1!==t.indexOf("after")?wt["after".concat(e)]:wt["before".concat(e)]:null},isDrillMap:function(){return"SmDrillMap"===this.componentId},isEditor:function(){return"editor"===this.$store.getters.getAction},mergeDefaultParams:function(){return Object.assign({},this.defaultParams.props,{loading:this.loading})},background:function(){return this.defaultParams.props.queryControl.background},textColor:function(){return this.defaultParams.props.queryControl.textColor},triggers:function(){return this.$store.getters.getActionsByComponentId(this.component.componentId)},enableSelectedLayers:function(){var e=this,t=this.triggers&&this.triggers.featureSelection||[],n=[];return t.forEach(function(t){t=t.config.sourceData.dataId,t=Object(T.m)(e.map,t,!0);n=n.concat(t)}),n},resetActionIds:function(){return(this.listeners||[]).filter(function(t){return M.b[t.type].reset}).map(function(t){return t.actionId})},mode:function(){return this.$store.getters.mode},mapStatus:function(){return this.uuid&&this.$store.getters.getDataCache(this.uuid).mapStatus||[]},selfLayersActionInfo:function(){var t,e={};for(t in this.filterActionData)-1===t.indexOf("track-layer")&&-1===t.indexOf("layers_layer")&&(e[t]=this.filterActionData[t]);return e},subComponentList:function(){var t=this.$store.getters.components;return Object.values(t.mapSubComponent).map(function(t){return t.type})},isCompare:function(){var t;return(null==(t=this.defaultParams)||null==(t=t.props)||null==(t=t.target)?void 0:-1!==t.indexOf("before"))||(null==(t=this.defaultParams)||null==(t=t.props)||null==(t=t.target)?void 0:-1!==t.indexOf("after"))},filter:function(){var e=this;return function(t){return!!e.isCompare&&Object(lt.f)(t,e.allowEpsgCode)}}},watch:{component:{handler:function(){this.componentId=Object(p.d)(this.component.uri),this.resetMapControlShow(),this.createWebMapNode()},deep:!0,immediate:!0},defaultParams:function(){this.resetMapControlShow()},currentProps:function(){this.createWebMapNode()},"filterActionData.mapInfo":{handler:function(t,e){var n;t&&Object.keys(t).length&&!P()(t,e)&&(e=t.mapDatas,n=t.data,t=t.uuid,this.uuid=t,this.mapInfoList=e,this.activeKey=n,this.dataCacheName=t)},immediate:!0},selfLayersActionInfo:{handler:function(t){this.updateMapSelfLayers(t)},immediate:!0},background:function(){Object(T.g)(this.background)},triggers:{handler:function(t,e){this.handleTriggers(t)},deep:!0},listeners:{handler:function(t,e){this.listenersHandler(t,e)}}},beforeDestroy:function(){this.map&&(this.map.off("styledata",this.updateInstanceStyle),this.map.off("click")),this.offTriggerEvent()},methods:{setLayerFeatures:function(t,e,n,r){this.$set(e.propDatas,"features",t.features);t=m()(t.fieldCaptions);t.unshift(this.$t("setting.webMap.notShowField")),this.$set(e.propDatas,"textField",e.propDatas.textField||t&&t[0]),e.fieldCaptions=t,r.layers[n]=e},changeLabelStatus:function(t){var e=m()(this.component.propDatas);e.tdtComponents.tdtMapSwitcher.data.label=t,this.$store.dispatch("CHANGE_COMPONENT_PROPS_SETTING",{componentId:this.$store.getters.activeComponentId,propDatas:e})},changeSelectTdtMapType:function(t){var e=m()(this.component.propDatas);e.tdtComponents.tdtMapSwitcher.data.select=t,this.$store.dispatch("CHANGE_COMPONENT_PROPS_SETTING",{componentId:this.$store.getters.activeComponentId,propDatas:e})},listenersHandler:function(t,e){this.filterActionData={},t&&!P()(t,e)&&this.getActionsData(e)},handleInstance:function(){var t=this;this.updateInstanceStyle=function(){t.$emit("instance-loaded",{isUpdateLayer:!0,map:t.map})},this.map.on("styledata",this.updateInstanceStyle),this.$emit("instance-loaded",this.map)},mapLoaded:function(t){var e=this;!!this.$store.getters.openAllDrag&&this.component.propDatas.keepBounds&&this.component.componentId&&this.$store.dispatch("SET_MAP_KEEP_BOUNDS",{keepBounds:!1,componentId:this.component.componentId}),this.updateMapSelfLayers(),this.$emit("load",t),this.map=t.map,this.handleInstance(),this.isDrillMap||(this.initResetFunction(),this.handleTriggers(this.triggers),setTimeout(function(){e.map.fire("moveend")},1e3),this.$refs.mapManager&&this.$refs.mapManager.setMap(this.map)),this.initListeners()},generateLayerNodes:function(t,e){var n=[],r=[];return e.layers&&r.push.apply(r,bt(e.layers)),e.trackLayers&&r.push.apply(r,bt(e.trackLayers)),r&&0<r.length&&r.forEach(function(t,e){"OBJ2"===t.propDatas.loaderType?t.propDatas.url=t.propDatas.obj2Url:"GLTF"===t.propDatas.loaderType?t.propDatas.url=t.propDatas.gltfUrl:"IMAGE"===t.propDatas.loaderType&&(t.propDatas.url=t.propDatas.imgUrl),n.push({subComponentId:Object(p.d)(t.uri),subComponentInfo:{props:t.propDatas,key:t.ref,ref:"TrackLayer"===t.componentType?t.ref:void 0}})}),n},generateTdtNodes:function(t){var e,n,r=[];for(e in t)t[e].show&&(n=Object(p.d)(t[e].uri),-1!==this.subComponentList.indexOf(n.replace("Sm",""))&&(t[e].splitLine=!0),r.push({subComponentId:n,subComponentInfo:{key:n,props:t[e],on:{"change-select-map-type":this.changeSelectTdtMapType,"change-label-status":this.changeLabelStatus}}}));return r},transformedSuspensionCmpsToContol:function(r,a){var i=this;if(r.hasOwnProperty("controlComponents"))for(var o in r.controlComponents)!function(){var t,e,n=r.controlComponents[o];n&&(t=Object(p.d)(n.uri),-1!==i.subComponentList.indexOf(t.replace("Sm",""))&&(n.splitLine=!0),"SmLayerList"===t&&(e=n.attributes.container&&n.attributes.container.toLowerCase(),n.attributes.getContainer=function(){return document.querySelector(".".concat(e))||document.getElementById(e)}),a.push({subComponentId:t,subComponentInfo:{key:o,props:n}}))}()},generateControlNodes:function(n){var r,a=this,i=[];this.transformedSuspensionCmpsToContol(n,i);for(r in n)!function(){var t,e=a.isMapSubComponent(r);e&&a.component.propDatas[r].show&&(n[r].mapTarget=n.target,"SmIdentify"===(e=Object(p.d)(e.uri))&&a.identifyToComponent(n[r]),-1!==a.subComponentList.indexOf(e.replace("Sm",""))&&(n[r].splitLine=!0),"SmLayerList"===e&&(t=n[r].attributes.container&&n[r].attributes.container.toLowerCase(),n[r].attributes.getContainer=function(){return document.querySelector(".".concat(t))||document.getElementById(t)}),i.push({subComponentId:e,subComponentInfo:{key:e,props:n[r]}}))}();return i},identifyToComponent:function(t){var e,n=t.layers,r=t.fields,a=[];for(e in n)!function(e){(n[e]||[]).forEach(function(t){a.push(r[e]||[])})}(e);t.fields=a,t.layers=[].concat.apply([],Object.values(n||{}))},isMapSubComponent:function(e){var t;return-1!==e.indexOf("identify")?{uri:"mapboxgl/web-map/control/identify/Identify"}:(t=this.$store.getters.components,Object.values(t.mapSubComponent).find(function(t){return-1<e.toLowerCase().indexOf(t.type.toLowerCase())}))},createWebMapNode:function(){var t=this.component,e=this.currentProps,n=m()(this.component.propDatas),r=n.tdtComponents||{},t=this.generateLayerNodes(t,e),r=this.generateTdtNodes(r),n=this.generateControlNodes(n);e.mapOptions||(e.mapOptions={}),e.mapOptions.preserveDrawingBuffer=!0,"unFixed"!==e.fixedMap&&(e.mapOptions.bounds=this.$store.getters.getMapByTarget(e.target)&&a.a.LngLatBounds.convert(this.$store.getters.getMapByTarget(e.target).bounds)),Object(d.q)()&&(e.isSuperMapOnline=!0),this.$store.getters.openAllDrag||this.handleMapFixed(e),this.childrenList=[].concat(t,r,n)},handleMapFixed:function(t,e){var n,r=t.fixedMap,a=t.mapOptions,a=void 0===a?{}:a;switch(r){case"fixed":n=!1;break;case"unFixed":n=!0;break;case"fixedInMobile":n=!("mobile"===this.mode)}n!==a.interactive&&(t.mapOptions.interactive=n)},resetMapControlShow:function(){var t,e=this.currentProps;for(t in e)-1!==t.indexOf("Control")&&e[t].show&&(e[t].show=!1)},changeDialogVisible:function(t){var e=this;this.isCreateDialog=t,this.$nextTick(function(){e.dialogVisible=t})},resourceInfoClicked:function(t){this.mapParam=t.resourceParam;var e=this.mapParam,n=e.title,r=e.id,a=e.url,i=e.mapOptions,e=e.proxy,o=m()(this.defaultParams.props),s=x(x({},o.mapOptions),{},{style:{version:8,sources:{},layers:[]},center:[0,0],zoom:1,bearing:0,pitch:0,renderWorldCopies:!1,tileSize:256});this.isDrillMap?(o.data[0]={layerId:"",serverUrl:a||"",withCredentials:t.resourceParam.withCredentials,proxy:e,mapId:r,relatedField:"",title:n},i||(o.mapOptions=s)):(o.serverUrl=a||"",o.withCredentials=this.mapParam.withCredentials,o.proxy=e,i?(t=o.mapOptions,o.mapOptions=Object.assign(t,i),o.mapId=""):(o.mapId=r,o.mapOptions=s),this.updateComponentName||(o.name=n)),this.updateMapName(n),this.isCompare?this.$emit("change-compare-props",{target:this.defaultParams.props.target,propDatas:o}):this.$store.dispatch("INIT_COMPONENT_CONFIG_SILENT",{componentId:this.component.componentId,propDatas:o})},updateMapName:function(t){t&&this.updateComponentName&&this.$store.dispatch("CHANGE_COMPONENT_PROPS_SETTING",{componentId:this.$store.getters.activeComponentId,componentName:t})},handleDataviz:function(){window.open(Object(d.h)())},selectMap:function(){this.$emit("selectMap",this.currentProps.target),this.changeDialogVisible(!0)},handleTriggers:function(e){var l=this;if(this.offTriggerEvent(),this.eventList=[],e&&this.map)for(var t in e)!function(c){var t=M.d[c].events||[],n=e[c];l.monitorEventLinkage(M.d,c,n),t.forEach(function(t){var e="handleTrigger".concat(t.replace(t[0],t[0].toUpperCase()));l[e]=function(a){var i,o=[],s=!0;n.forEach(function(t){var e=M.d[c].callback({e:a},t,l),n=g.a.$options.updateFeature(e.feature,"".concat(l.component.componentId,"-").concat(c)),r=l.getUpdateCondition(c,t,e.passingActionInfo);s=e.status,i=e.passingActionInfo,delete e.feature,delete e.passingActionInfo,r&&o.push(x(x({actionId:t.actionId},e),{},{featureId:n}))}),s&&l.$store.dispatch("UPDATE_ACTION",{componentId:l.component.componentId,type:c,datas:o,passingActionInfo:i,status:"active"})},l.map.on(t,l[e]),"click"===t&&n.forEach(function(t){var e=t.actionId,t=t.config.sourceData.dataId,t=Object(T.m)(l.map,t),t=Object(T.f)(l.map,t,e);l.eventList=l.eventList.concat(t)}),l.eventList.push({eventName:t,listenerName:e})})}(t)},getActionsData:function(){var c=this,l=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],u=[];return this.map&&this.listeners.forEach(function(t){var e=t.type,n=t.targetData,r=t.featureId,a=t.actionId,i=t.timestamp,o=t.blockEventLinkage,n=n&&n.dataId,s=l.find(function(t){return t.actionId===a});s&&s.timestamp===i||o||(s=c.$store.getters.getPassingActionInfoByActionId(a,dt.a[e]||"boundsChange"),i=x(x({},t),{},{passingActionInfo:s}),t=(o=Object(T.l)(c.map,n))&&o.features||[],r&&(i.feature=g.a.$options.getData(r)),s=M.b[e].callback(i,t,c),u.push(s),"switchMap"!==e&&"switchDataSource"!==e&&"appendDatas"!==e||(c.filterActionData=Object.assign({},c.filterActionData,s)),c.emitEventLinkage(e,a,n,s))}),u},initResetFunction:function(){var t=this;this.map.off("click",this.callback),this.callback=function(){Object(M.c)(t.map),t.$store.dispatch("UPDATE_ACTIONS_STATUS",{actionIds:t.resetActionIds,status:"reset",fromComponentId:t.component.componentId})},this.map.on("click",this.callback)},loadingChange:function(t){this.loading=t},offTriggerEvent:function(){var r=this;this.eventList&&this.map&&this.eventList.forEach(function(t){var e,n;t&&(e=t.eventName,n=t.listenerName,(t=t.layers)&&t instanceof Array?t.forEach(function(t){r.map.off(e,t,n)}):r[n]&&(r.map.off(e,r[n]),r[n]=null))})}}},I=(e("fous"),Object(u.a)(v,function(){var n=this,t=n.$createElement,r=n._self._c||t;return r(n.componentId,n._b({tag:"component",style:n.defaultParams.style,on:{load:n.mapLoaded}},"component",n.mergeDefaultParams,!1),[n.isEditor&&!n.validMap?r("div",{staticClass:"map-mask",attrs:{slot:n.isDrillMap?"blank":"default"},slot:n.isDrillMap?"blank":"default"}):n._e(),n._v(" "),n._l(n.childrenList,function(t){var e=t.subComponentId,t=t.subComponentInfo;return[r(e,n._g(n._b({key:n.mode+"-"+t.key,ref:t.ref,refInFor:!0,tag:"component"},"component",t.props,!1),t.on))]}),n._v(" "),n.isEditor&&!n.validMap?r("div",{staticClass:"btn-wrap",style:n.compareMapBtnStyle,attrs:{slot:n.isDrillMap?"blank":"default"},slot:n.isDrillMap?"blank":"default"},[r("sm-button",{staticClass:"customRenderButton",attrs:{type:"primary"},on:{click:n.selectMap}},[n._v(n._s(n.$t("setting.webMap.selectMap")))]),n._v(" "),r("div",{staticClass:"line"}),n._v(" "),r("sm-button",{staticClass:"customRenderButton",attrs:{type:"primary"},on:{click:n.handleDataviz}},[n._v(n._s(n.$t("setting.webMap.makeMapOnline")))])],1):n._e(),n._v(" "),n.isCreateDialog?r("sm-resource-selector",{attrs:{slot:n.isDrillMap?"blank":"default",dialogVisible:n.dialogVisible,useType:n.isDrillMap?"DrillMap":"Map",filter:n.filter},on:{resourceinfoclicked:n.resourceInfoClicked,dialogvisible:n.changeDialogVisible},slot:n.isDrillMap?"blank":"default"}):n._e(),n._v(" "),r("map-manager",{ref:"mapManager",attrs:{slot:n.isDrillMap?"blank":"default",mapInfoList:n.mapInfoList,mapStatus:n.mapStatus,dataCacheName:n.dataCacheName,propDatas:n.defaultParams.props,activeKey:n.activeKey},on:{loadingChange:n.loadingChange},slot:n.isDrillMap?"blank":"default"}),n._v(" "),r("sm-table-popup",n._b({directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"tablePopup",attrs:{slot:n.isDrillMap?"blank":"default",background:n.background,textColor:n.textColor},slot:n.isDrillMap?"blank":"default"},"sm-table-popup",n.tablePopupProps,!1))],2)},[],!1,null,null,null));t.default=I.exports},cRpN:function(t,e,n){},dDBl:function(t,e,n){"use strict";var r=n("TuIa"),a=n("FhCG"),i=n("oTir"),o=n("tmJK"),a=Object.assign({},a.TableProps),r={name:"SmTable",defaultComponent:r.default,mixins:[i.a,o.a],inheritAttrs:!1,props:a},i=n("KHd+"),o=Object(i.a)(r,void 0,void 0,!1,null,null,null);e.a=o.exports},fous:function(t,e,n){"use strict";n("SCEM")},jFi5:function(t,e,n){"use strict";n("Su6f")},l6bU:function(t,e,n){"use strict";var a=n("Lb6U"),m=n("4zwu"),r=n("zT9C"),y=n.n(r);function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(e,t){var n,r=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)),r}function g(r){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach(function(t){var e,n;e=r,n=a[t=t],(t=function(t){t=function(t,e){if("object"!==i(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);n=n.call(t,e||"default");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"===i(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(a,t))})}return r}r={data:function(){return{}},methods:{monitorEventLinkage:function(n,r,a,i,o){var s=this,t="linkage-".concat(r);this.$off("actionEventLinkage".concat(r),this[t]),this[t]=function(t){var e;r===t.triggerType&&(e=(t=s._getEventLinkageData(t,a,n,r,i,o)).datas,t=t.passingActionInfo,s.$store.dispatch("UPDATE_ACTION",{componentId:s.component.componentId,type:r,status:"active",datas:e,passingActionInfo:t}))},this.$on("actionEventLinkage".concat(r),this[t])},emitEventLinkage:function(t,e,n,r){t=a.a[t];!t||4<arguments.length&&void 0!==arguments[4]&&!arguments[4]||(e=this.$store.getters.getPassingActionInfoByActionId(e,t),this.$emit("actionEventLinkage".concat(t),{triggerType:t,dataId:n,data:r,from:e}))},getUpdateCondition:function(t,e,n){var r=this.$store.getters.getTargetIdBySourceId(this.component.componentId,e.actionId,t,e.targetAction);return!(n&&r&&n.find(function(t){return t.componentId===r}))},_getEventLinkageData:function(i,o,s,c,l,u){for(var p,f=this,t=this.$store.getters.getTriggerEventByComponentIdAndType(this.component.componentId,c)||{},h=(h=y()(t.datas)||[]).map(function(t){return t.blockEventLinkage=!0,t}),d=0;d<o.length;d++)!function(){var e=o[d];if(e.config.sourceData.dataId!==i.dataId)return;var t,n=s[c].callback({features:l,actionEventParams:i},e,f),r=m.a.$options.updateFeature(n.feature,"".concat(f.component.componentId,"-").concat(c)),a=f.getUpdateCondition(c,e,n.passingActionInfo);p=n.passingActionInfo,delete n.feature,delete n.passingActionInfo,delete n.highlightOptions,a&&(t=-1<(a=h.findIndex(function(t){return t.actionId===e.actionId}))?1:0,a=-1<a?a:0,n=g(g({actionId:e.actionId},n),{},{featureId:(!u||-1!==u.indexOf(e.targetAction))&&r}),h.splice(a,t,n))}();return{datas:h,passingActionInfo:p}}}},n=n("KHd+"),n=Object(n.a)(r,void 0,void 0,!1,null,null,null);e.a=n.exports},mh0i:function(t,e,n){"use strict";n("Tpw3")},oUIn:function(t,e,n){"use strict";var r=n("oTir"),a=n("dDBl"),i=n("qAG6"),a={name:"SmTablePopup",components:{SmTable:a.a},mixins:[r.a],props:{data:{type:Array,default:function(){return[]}},columns:{type:Array,default:function(){return[]}},splitLine:{type:Boolean,default:!0}},watch:{"collapseCardHeaderBgStyle.background":function(t){this.setTheadStyle("background",t)},"tablePopupBgStyle.background":function(t){Object(i.t)(t)},"headingTextColorStyle.color":function(t){this.setTheadStyle("color",t)}},mounted:function(){this.setTheadStyle("color",this.headingTextColorStyle.color),this.setTheadStyle("background",this.collapseCardHeaderBgStyle.background)},methods:{setTheadStyle:function(e,n){var t;this.$el&&(t=this.$el.querySelectorAll("tr > th"))&&t.forEach(function(t){t.style[e]=n})}}},r=n("KHd+"),n=Object(r.a)(a,function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("div",{class:{"sm-component-table-popup":!0,"with-split-line":t.splitLine},style:[t.tablePopupBgStyle,t.getTextColorStyle]},[e("sm-table",{staticClass:"sm-component-table-popup__table",attrs:{"data-source":t.data,columns:t.columns,rowKey:function(t,e){return e},pagination:!1}})],1)},[],!1,null,null,null);e.a=n.exports},z9S9:function(t,e,n){"use strict";n.r(e);var r=n("3Dh3"),a=n("aXEy"),i=n("zT9C"),o=n.n(i),i=n("6G66"),s=n("9/5/"),s=n.n(s),c=n("FuRH");function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(e,t){var n,r=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)),r}function p(r){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?u(Object(a),!0).forEach(function(t){var e,n;e=r,n=a[t=t],(t=function(t){t=function(t,e){if("object"!==l(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);n=n.call(t,e||"default");if("object"!==l(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"===l(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(a,t))})}return r}a={components:{MapRender:a.default},mixins:[i.a],props:{component:{type:Object,required:!0},defaultParams:{type:Object}},data:function(){return{componentId:null,allowEpsgCode:""}},computed:{getMapProps:function(){return function(t){var e=this.defaultParams.props,n=t?e.afterMapOptions:e.beforeMapOptions;return n.orientation=e.orientation,{component:{componentId:null,componentType:"WebMap",dataIds:this.component.dataIds&&this.component.dataIds[t],propDatas:n,uri:"mapboxgl/web-map/WebMap"},defaultParams:{props:o()(n)},updateComponentName:!1}}},currentPage:function(){return this.$store.getters.currentPage}},watch:{"$store.getters.currentPageId":function(){var n=this;setTimeout(function(){var t=null==(t=n.currentPage)||null==(t=t.setting)?void 0:t.enterAnimation,e=t.delay,t=t.duration;setTimeout(function(){n.$refs.compare.resize()},1e3*(e+t))},500)},"defaultParams.props.isRefresh":{handler:function(t){var e=this;t&&setTimeout(function(){e.refresh(),e.resetInitStatus()},1e3)}}},created:function(){this.setComponentId()},mounted:function(){this.scrollRootEl=document.querySelector(".sm-container"),this.scrollRootEl.addEventListener("scroll",this.onScroll)},beforeDestroy:function(){this.scrollRootEl.removeEventListener("scroll",this.onScroll)},methods:{refresh:function(){this.$refs.compare&&this.$refs.compare.resize()},onScroll:s()(function(){this.$refs.compare&&this.$refs.compare.refreshRect()},600),resetInitStatus:function(){this.$store.dispatch("CHANGE_COMPONENT_PROPS_SETTING",{componentId:this.component.componentId,propDatas:p(p({},this.defaultParams.props),{},{isRefresh:!1})})},setComponentId:function(){this.componentId=Object(r.d)(this.component.uri)},changeComponentProps:function(t){-1!==t.target.indexOf("before")?this.defaultParams.props.beforeMapOptions=t.propDatas:this.defaultParams.props.afterMapOptions=t.propDatas,this.$store.dispatch("INIT_COMPONENT_CONFIG_SILENT",{componentId:this.$store.getters.activeComponentId,propDatas:o()(this.defaultParams.props)})},handleBeforeInstance:function(){this.isBeforeMapLoad=!0,this.handleInstance()},handleAfterInstance:function(){this.isAfterMapLoad=!0,this.handleInstance()},handleInstance:function(){this.isBeforeMapLoad&&this.isAfterMapLoad&&this.$emit("instance-loaded")},changeAllowEpsgCode:function(t){var e=t.split("_")[0],t=t.replace(e,"before"===e?"after":"before"),e=c.a.$options.getMap(t);e.style&&!!Object.keys(e.style._layers).length&&(this.allowEpsgCode=e.getCRS().epsgCode)}}},i=n("KHd+"),s=Object(i.a)(a,function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("div",[t.defaultParams.props.beforeMapOptions&&t.defaultParams.props.afterMapOptions?e(t.componentId,t._b({ref:"compare",tag:"component",style:t.defaultParams.style,attrs:{"before-map-options":null,"after-map-options":null}},"component",t.defaultParams.props,!1),[e("MapRender",t._b({key:t.defaultParams.props.beforeMapOptions.target,attrs:{slot:"beforeMap",allowEpsgCode:t.allowEpsgCode},on:{"change-compare-props":t.changeComponentProps,"instance-loaded":t.handleBeforeInstance,selectMap:t.changeAllowEpsgCode},slot:"beforeMap"},"MapRender",t.getMapProps(0),!1)),t._v(" "),e("MapRender",t._b({key:t.defaultParams.props.afterMapOptions.target,attrs:{slot:"afterMap",allowEpsgCode:t.allowEpsgCode},on:{"change-compare-props":t.changeComponentProps,"instance-loaded":t.handleAfterInstance,selectMap:t.changeAllowEpsgCode},slot:"afterMap"},"MapRender",t.getMapProps(1),!1))],1):t._e()],1)},[],!1,null,null,null);e.default=s.exports}}]);