(window.webpackJsonp=window.webpackJsonp||[]).push([[56,18],{EBC7:function(t,e,n){"use strict";n.r(e);var r=n("oCYn"),i=n("3Dh3"),a=n("zT9C"),o=n.n(a),a=n("XaGS"),s=n.n(a),u=n("GSdF"),c=n("FuRH"),a=n("6G66"),p=n("QCDS"),a={mixins:[a.a],props:{pageId:{type:String},component:{type:Object,required:!0},defaultParams:{type:Object}},data:function(){return{componentId:null,renderProps:null}},computed:{background:function(){return-1!==this.excludeComponentsBackground.indexOf(this.component.componentType)?{}:Object(u.a)(this.component.propDatas)},subComponentList:function(){var t=this.$store.getters.components;return Object.values(t.mapSubComponent).map(function(t){return t.type})},excludeComponentsBackground:function(){return this.subComponentList.concat("Container")},mapsOnScreen:function(){return this.$store.getters.mapsOnScreen[this.pageId]},firstMapTarget:function(){return(this.mapsOnScreen[0]||{}).value}},watch:{component:{handler:function(){var t=Object(i.d)(this.component.uri);this.componentId=r.default.component(t)?t:null},deep:!0,immediate:!0},"defaultParams.props":{handler:function(t,e){s()(t,e)||(this.renderProps=o()(this.defaultParams.props),-1===this.excludeComponentsBackground.indexOf(this.component.componentType)&&(this.renderProps.background=""),"Iframe"===this.component.componentType&&(this.renderProps.src=Object(p.c)(this.renderProps.src)),-1!==["LiquidFill","TimeRange"].indexOf(this.component.componentType)&&(this.renderProps.backgroundColor=this.renderProps.backgroundColorReplacer,delete this.renderProps.backgroundColorReplacer))},immediate:!0},mapsOnScreen:function(t,e){s()(t,e)||this.renderProps.mapTarget&&!c.a.$options.getMap(this.renderProps.mapTarget)&&(this.renderProps.mapTarget=this.firstMapTarget)}},created:function(){this.setDefaultMapTarget()},methods:{setDefaultMapTarget:function(){this.renderProps&&this.renderProps.hasOwnProperty("mapTarget")&&!this.renderProps.mapTarget&&(this.renderProps.mapTarget=this.getRelatedMapTarget())},getRelatedMapTarget:function(){var t=this.$store.getters,e=t.componentsOnScreen,t=t.activeComponentId,n=this.$store.getters.getGridLayoutByPageId(this.pageId,this.$store.getters.mode);return Object(i.i)(e,n.content||[],t)}}},n=n("KHd+"),n=Object(n.a)(a,function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("div",{style:t.background},[e(t.componentId,t._b({tag:"component",style:t.defaultParams.style,attrs:{componentId:t.component.componentId}},"component",t.renderProps,!1)),t._v(" "),t._t("fullScreen")],2)},[],!1,null,null,null);e.default=n.exports},ZZtp:function(t,e,n){"use strict";n.r(e);var r=n("EBC7"),o=n("M7pi"),s=n("gOn5"),i=n("XaGS"),u=n.n(i),i=n("zT9C"),a=n.n(i),i=n("wd/R"),c=n.n(i);function p(e,t){var n,r=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)),r}function l(r){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?p(Object(i),!0).forEach(function(t){var e,n;e=r,n=i[t=t],(t=function(t){t=function(t,e){if("object"!==d(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);n=n.call(t,e||"default");if("object"!==d(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"===d(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):p(Object(i)).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(i,t))})}return r}function d(t){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}i={mixins:[r.default],data:function(){return{currentProps:a()(this.renderProps),currentIndex:0,eventList:[],nextEnable:null,playState:!1}},computed:{currentDataCache:function(){var t=this.renderProps.controledDatas;return this.$store.getters.getDataCache(t&&t[0])},mapStatus:function(){return this.$store.getters.getDataCache(this.uuid).mapStatus||[]},getControlData:function(){var t=this.currentDataCache,e=t&&t.dataInfo||{};return{start:e.start,end:e.end,step:e.step,timing:(t||{}).timing,currentProps:this.renderProps}},visible:function(){var t=this.renderProps;return!t||!t.hasOwnProperty("visible")||t.visible},uuid:function(){for(var t in this.$store.getters.getAllDataCacheByHashId(this.component.componentId))return t;return null},options:function(){return-1!==this.currentProps.timeType.indexOf("customize")?this.currentProps.data:null},triggers:function(){return this.$store.getters.getActionsByComponentId(this.component.componentId)},allLoaded:function(){return!!this.mapStatus.length&&this.mapStatus.every(function(t){return t.status})}},watch:{getControlData:{handler:function(t,e){var n,r,i,a;u()(t,e)||(a=(t=this.getControlData).start,n=t.end,r=t.step,i=t.timing,t=t.currentProps,e=e&&e.timing,-1===t.timeType.indexOf("customize")?(a=this.getData(a,n,r),this.data=a,t=Object.assign({},t,{data:a}),e!==i&&i&&(this.currentIndex=0<a.length?a.length-1:0),t.currentIndex=this.currentIndex,((this.currentProps=t).controledDatas&&t.controledDatas.length||t.data&&t.data.length)&&this.timeLine&&this.timeLine.$emit("timelinechanged",{currentIndex:this.currentIndex})):this.currentProps=Object.assign({},t))},deep:!0,immediate:!0},options:{handler:function(t){var e=this.currentProps.data,n=e[this.currentIndex]&&e[this.currentIndex].value;!t||n&&t.find(function(t){return t.value===n})||this.timeLine&&this.timeLine.$emit("timelinechanged",{currentIndex:0})},deep:!0,immediate:!0},triggers:{handler:function(t,e){this.handleTriggers(t),this.timeLine&&this.timeLine.$emit("timelinechanged",{currentIndex:this.currentIndex})},deep:!0},mapStatus:{handler:function(n,t){this.nextEnable=function(t){for(var e=0;e<n.length;e++)if(!0===n[e].status&&e===t)return!0;return!1}},immediate:!0},"currentProps.autoPlay":function(){this.playState=this.currentProps.autoPlay},"renderProps.formatter":{handler:function(t){var e=this.currentProps,n=e.timeType,e=e.data;-1===n.indexOf("customize")&&(this.currentProps.label=this.getLabel(e))},immediate:!0},"currentProps.timeType":{handler:function(t){this.data=this.renderProps.data,this.currentProps.label=this.getLabel(this.currentProps.data)},immediate:!0},"renderProps.data":{handler:function(){var t=this.currentProps.data||[];t&&"object"===d(t)&&(this.data=a()(t),this.currentProps.data=t.map(function(t){return l(l({},t),{},{tooltip:{formatter:t.label}})})),this.currentProps.label=this.getLabel(t)},immediate:!0}},mounted:function(){var t;this.mapStatus&&this.mapStatus.length&&(t=this.mapStatus.map(function(t){return t.status=!1,t}),this.$store.dispatch("UPDATE_DATA_INFO",{uuid:this.uuid,dataInfo:{mapStatus:t}})),this.playState=this.currentProps.autoPlay},beforeDestroy:function(){this.offTriggerEvent()},methods:{timeFormatter:function(t,e,n,r){return t&&"object"===d(t[0])?t[n].label:(e=e||t[n],"auto"!==r&&c()(e,"YYYY-MM--DD HH:mm:ss").isValid()?c()(e,"YYYY-MM--DD HH:mm:ss").format(r):e)},getLabel:function(n){var r=this,t=this.currentProps,i=t.formatter,a=t.timeType;return l({formatter:function(t,e){return-1!==a.indexOf("customize")?n[e].label:r.timeFormatter(n,t,e,i)}},t.labelStyle||{})},timelineChange:function(t){"customizeMap"!==this.currentProps.timeType?this.currentIndex=t&&t.currentIndex:(this.pause=!this.autoPlayControl,this.allLoaded?(this.pause||this.setPlayState(!0),this.currentIndex=t&&t.currentIndex):this.nextStep(t&&t.currentIndex))},timelineplaychanged:function(t){this.autoPlayControl=t.playState,this.playState=t.playState},setPlayState:function(t){this.$refs.timeLine.setPlayState(t)},nextStep:function(t){var e=this;this.timer&&clearInterval(this.timer),this.setPlayState(!1),this.timer=setInterval(function(){e.nextEnable(t)&&(clearInterval(e.timer),e.timer=null,e.pause||setTimeout(function(){e.setPlayState(!0)},e.playInterval))},100)},getData:function(t,e,n){var r=[];if(t&&e&&n&&n.value)for(var i=o.a.getSecondsByStep(n),a=parseInt(e);a>=parseInt(t);)r.unshift(o.a.timestamp2Date(a)),a-=i;return r},initTriggers:function(){var t=this;this.timeLine=this.$refs.timeLine,this.triggers&&this.handleTriggers(this.triggers),setTimeout(function(){return t.timeLine.$emit("timelinechanged",{currentIndex:t.currentIndex})},3e3)},handleTriggers:function(e){var o=this;if(this.offTriggerEvent(),this.eventList=[],e&&this.timeLine)for(var t in e)!function(i){var t=s.b[i].events||[],a=e[i];t.forEach(function(t){var e="handleTrigger".concat(t.replace(t[0],t[0].toUpperCase()));o[e]=function(n){var r=[];a.forEach(function(t){var e=s.b[i].callback(n,t,o);r.push(l({actionId:t.actionId,featureId:e.data.featureId},e))}),o.$store.dispatch("UPDATE_ACTION",{componentId:o.component.componentId,type:i,datas:r,status:"active"})},o.timeLine.$on(t,o[e]),o.eventList.push({eventName:t,listenerName:e})})}(t)},offTriggerEvent:function(){var n=this;this.eventList&&this.timeLine&&this.eventList.forEach(function(t){var e=t.eventName,t=t.listenerName;n[t]&&(n.timeLine.$off(e,n[t]),n[t]=null)})}}},r=n("KHd+"),n=Object(r.a)(i,function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("div",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"visible"}],style:t.background},[e(t.componentId,t._b({ref:"timeLine",tag:"component",style:t.defaultParams.style,on:{timelinechanged:t.timelineChange,timelineplaychanged:t.timelineplaychanged,"hook:mounted":t.initTriggers}},"component",t.currentProps,!1))],1)},[],!1,null,null,null);e.default=n.exports}}]);