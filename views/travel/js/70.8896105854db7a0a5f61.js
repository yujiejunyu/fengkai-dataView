(window.webpackJsonp=window.webpackJsonp||[]).push([[70,34,38],{CKgU:function(e,t,r){"use strict";var a=r("FuRH"),s=r("yIpb"),i=r("K79h"),o=r("oCYn"),r=r("YKMj");function c(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==h(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!==h(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===h(e)?e:String(e)}(o.key),o)}}function u(e,t){return(u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function l(r){var o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=n(r),t=(e=o?(e=n(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===h(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function n(e){return(n=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var p=function(e,t,r,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"===("undefined"==typeof Reflect?"undefined":h(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var i=e.length-1;0<=i;i--)(n=e[i])&&(s=(a<3?n(s):3<a?n(t,r,s):n(t,r))||s);return 3<a&&s&&Object.defineProperty(t,r,s),s};function f(t,r){for(var e=arguments.length,o=new Array(2<e?e-2:0),n=2;n<e;n++)o[n-2]=arguments[n];var a=t.constructor.options;a.mixins&&a.mixins.forEach(function(e){e[r]&&(e=e[r]).call.apply(e,[t].concat(o))}),a[r]&&(a=a[r]).call.apply(a,[t].concat(o))}o=function(e){var t=n;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&u(t,e);var r,o=l(n);function n(){var e=this,t=n;if(e instanceof t)return o.apply(this,arguments);throw new TypeError("Cannot call a class as a function")}return t=n,(e=[{key:"mapTargetChanged",value:function(e,t){var r;e&&t&&e!==t&&(t=t||this.firstDefaultTarget,(r=a.a.$options.getMap(t))&&this.removeMap(r,t),a.a.$options.getMap(e))&&this.loadMap(e)}},{key:"mounted",value:function(){var e=this.getTargetName();this.firstDefaultTarget=e,a.a.$options.getMap(e)&&this.loadMap(e),a.a.$on("load-map",this.loadMapSucceed),s.a.$on("delete-map",this.removeMapSucceed)}},{key:"beforeDestroy",value:function(){this.removeMap(),a.a.$off("load-map",this.loadMapSucceed),s.a.$off("delete-map",this.removeMapSucceed)}},{key:"getFirstTarget",value:function(){var e,t;for(t in a.a.$options.getAllMaps())if(t){e=t;break}return e}},{key:"getTargetName",value:function(){var e=this.$parent,e=e&&e.$options.name&&-1!==["smwebmap","smncpmap"].indexOf(e.$options.name.toLowerCase())&&e.target;return this.mapTarget||e||this.getFirstTarget()}},{key:"loadMap",value:function(e){var t=this;this.firstDefaultTarget||(this.firstDefaultTarget=e),this.map=a.a.$options.getMap(e),this.webmap=a.a.$options.getWebMap(e),this.viewModel&&"function"==typeof this.viewModel.setMap&&this.viewModel.setMap({map:this.map,webmap:this.webmap,mapTarget:e}),f(this,"loaded",this.map,e),this.$nextTick(function(){t.$emit("loaded")})}},{key:"removeMap",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.map,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.getTargetName();e&&(this.viewModel&&this.viewModel.removed&&this.viewModel.removed(),f(this,"removed",e,t),this.map=null,this.webmap=null,this.firstDefaultTarget=null)}},{key:"loadMapSucceed",value:function(e,t){t===this.getTargetName()&&this.loadMap(t)}},{key:"removeMapSucceed",value:function(e){e===this.getTargetName()&&this.removeMap()}},{key:"mapNotLoadedTip",value:function(){return!this.map&&(i.a.destroy(),i.a.warning(this.$t("warning.unassociatedMap")),!0)}}])&&c(t.prototype,e),r&&c(t,r),Object.defineProperty(t,"prototype",{writable:!1}),n}(o.default);p([Object(r.Prop)()],o.prototype,"mapTarget",void 0),p([Object(r.Watch)("mapTarget")],o.prototype,"mapTargetChanged",null),o=p([r.Component],o),t.a=o},K79h:function(e,t,r){"use strict";var o=r("Iv0b");function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(t,e){var r,o=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,r)),o}function n(o){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?s(Object(n),!0).forEach(function(e){var t,r;t=o,r=n[e=e],(e=function(e){e=function(e,t){if("object"!==a(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!==a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===a(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(n,e))})}return o}var i="sm-component-message",c=o.default.config;c({prefixCls:i}),o.default.config=function(e){e.prefixCls&&e.prefixCls!==i&&o.default.destroy(),c(n(n({},e),{},{prefixCls:e.prefixCls||i}))},t.a=o.default},QsSW:function(e,t,r){"use strict";var o=r("gsT3"),n=r("vZOP"),a=r("ghbr"),s=r("oTir"),i=r("tmJK"),s={mixins:[s.a,i.a],inheritAttrs:!1,model:{prop:"value",event:"change.value"},computed:{extralListeners:function(){var t=this;return{"change.value":function(e){t.$emit("change.value",e)}}}}},i=r("KHd+"),r=Object(i.a)(s,void 0,void 0,!1,null,null,null).exports,s=Object.assign(Object.assign({},n.default),{size:a.a.oneOf(["small","large","default","middle"])}),n={name:"SmInput",defaultComponent:o.default,mixins:[r],props:s,computed:{extralProps:function(){return{size:"middle"===this.size?void 0:this.size}},componentClass:function(){return{"sm-component-input-affix-wrapper-md":"middle"===this.size}}},mounted:function(){var e;"middle"===this.size&&(e=this.$el.querySelector(".sm-component-input"))&&e.classList&&e.classList.add("sm-component-input-md")}},a=Object(i.a)(n,void 0,void 0,!1,null,null,null);t.a=a.exports},SqLP:function(e,t,r){"use strict";r.r(t),r.d(t,"iconTypes",function(){return c});var o=r("00x4"),n=r("oTir"),a=r("tmJK"),s=r("ghbr"),i=r("qAG6"),c={tabIndex:s.a.number,type:s.a.string.def("info"),component:s.a.any,viewBox:s.a.any,spin:s.a.bool.def(!1),rotate:s.a.number,theme:s.a.oneOf(["filled","outlined","twoTone"]).def("outlined"),twoToneColor:s.a.string,role:s.a.string,iconStyle:s.a.object,iconClass:s.a.string,autoPrefix:s.a.bool.def(!0)},s={name:"SmIcon",defaultComponent:o.default,mixins:[n.a,a.a],props:c,computed:{customIconClass:function(){return this.autoPrefix?"sm-components-icon-"+this.iconClass:this.iconClass},iconProps:function(){return Object(i.q)(this.componentProps,["iconStyle","iconClass","autoPrefix"])}},render:function(e){var t;return t=this.iconClass?e("i",{class:this.customIconClass}):e(this.getComponentInstance(),{props:this.iconProps,attrs:this.$attrs,on:this.componentListeners,scopedSlots:this.$scopedSlots},this.renderChildren()),e("div",{class:"sm-component-icon",style:this.iconStyle},[t])}},o=r("KHd+"),n=Object(o.a)(s,void 0,void 0,!1,null,null,null);t.default=n.exports},"Y/bV":function(e,t,r){"use strict";r.r(t);var o=r("oTir"),n=r("CKgU"),a=r("rn6b"),s=r("hdLw"),i=r.n(s),s=r("zT9C"),c=r.n(s),u=r("7mrb"),l=(r("xKWM"),r("hUYj")),h=r("qGvU"),p=r("kzZv"),f=r("qAG6");function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(t,e){var r,o=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,r)),o}function m(o){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?y(Object(n),!0).forEach(function(e){var t,r;t=o,r=n[e=e],(e=b(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach(function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(n,e))})}return o}function v(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,b(o.key),o)}}function b(e){e=function(e,t){if("object"!==d(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!==d(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===d(e)?e:String(e)}function g(e,t){return(g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function w(r){var o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=S(r),t=(e=o?(e=S(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===d(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var k=function(e){var t=n;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&g(t,e);var r,o=w(n);function n(e){var t;if(this instanceof n)return(t=o.call(this)).options=e||{},t.searchTaskId=0,t.options.cityGeoCodingConfig={addressUrl:"https://www.supermapol.com/iserver/services/localsearch/rest/searchdatas/China/poiinfos",key:e.onlineLocalSearch.key||"fvV2osxwuZWlY0wJb8FEb2i5"},t.searchtType=["layerNames","onlineLocalSearch","restMap","restData","iportalData","addressMatch"],t.markerList=[],t.popupList=[],t.errorSourceList={},t;throw new TypeError("Cannot call a class as a function")}return t=n,(e=[{key:"setMap",value:function(e){e=e.map;this.map=e}},{key:"search",value:function(e){var t=this,e=(this.searchCount=0,this.searchResult={},this.errorSourceList={},this.keyWord=e,this.maxFeatures=100<=parseInt(this.options.maxFeatures)?100:parseInt(this.options.maxFeatures)||8,this.searchtType.forEach(function(e){t.options[e]&&("onlineLocalSearch"===e&&t.options[e].enable?t.searchCount+=1:"onlineLocalSearch"!==e&&(e=t.options[e].length,t.searchCount+=e))},this),m({},this.options)),r=e.layerNames,o=e.onlineLocalSearch,n=e.restMap,a=e.restData,s=e.iportalData,e=e.addressMatch;return r&&this._searchFromLayer(r),o.enable&&this._searchFromPOI(o),n&&this._searchFromRestMap(n),a&&this._searchFromRestData(a),s&&this._searchFromIportal(s),e&&this._searchFromAddressMatch(e),this.searchTaskId}},{key:"getFeatureInfo",value:function(e,t){var r=this.options.resultRender;this.keyWord=e,this._reset(),this.fire("search-selected-info"+this.searchTaskId,{data:t}),r||this._showResultToMap(t)}},{key:"_showResultToMap",value:function(e){var t=e.geometry||{};this.options.alwaysCenter||"MultiPolygon"!==t.type&&"Polygon"!==t.type?this.options.alwaysCenter||"LineString"!==t.type?this._addPoint(e):this._addLine(e):this._addPolygon(e)}},{key:"_addPoint",value:function(e){var t=e.properties||e,r=e.geometry||[e.location.x,e.location.y],o={coordinates:null,info:[]},n=t.address||e.filterAttribute.filterAttributeValue||t.name;if("MultiPolygon"===r.type||"Polygon"===r.type||"LineString"===r.type?o.coordinates=Object(f.h)(e):o.coordinates=r.coordinates||r,o.coordinates&&o.coordinates.length&&!o.coordinates.find(function(e){return isNaN(+e)})){if(this.keyWord.indexOf("：")<0)o.info.push({attribute:Object(p.a)().t("search.address"),attributeValue:n});else for(var a in t)t[a]&&o.info.push({attribute:a,attributeValue:t[a]});this.fire("set-popup-content"+this.searchTaskId,{popupData:o})}else this.fire("addfeaturefailed"+this.searchTaskId,{error:Object(p.a)().t("search.illegalFeature")})}},{key:"_addLine",value:function(){console.log("draw line here")}},{key:"_addPolygon",value:function(e){var t,r;e&&this.map&&(t=Object(u.default)(e).geometry.coordinates,e=e,(r=this.map.getSource("searchResultLayer"))?r.setData(e):this.map.addLayer({id:"searchResultLayer",type:"fill",source:{type:"geojson",data:e},layout:{},paint:{"fill-color":"rgb(255, 0, 0)","fill-opacity":.8}}),this.map.easeTo({center:t}))}},{key:"setPopupContent",value:function(e,t,r){t.style.display="block";var o=new i.a.Popup({className:"sm-mapboxgl-tabel-popup sm-component-search-result-popup",closeOnClick:!0,closeButton:!1,maxWidth:"none",anchor:"bottom"}),n=new i.a.Marker;this.popupList.push(o),this.markerList.push(n),o.setLngLat(e).setDOMContent(t).addTo(this.map),o.on("open",function(){r&&r()}),n.setLngLat(e).setPopup(o).addTo(this.map),this.map.flyTo({center:e})}},{key:"_searchFromLayer",value:function(e){var r=this;setTimeout(function(){e.forEach(function(e){var t=r.map.getSource(e);t?(t=c()(t._data.features),t=r._getFeaturesByKeyWord(r.keyWord,t).slice(0,r.maxFeatures),r._searchFeaturesSucceed(t,e)):r._searchFeaturesFailed("The ".concat(e," does not exist"),e)},r)},0)}},{key:"_searchFeaturesFailed",value:function(e,t){e&&console.log(e),this.errorSourceList[t]||(this.searchCount--,this.errorSourceList[t]=t,0===this.searchCount&&this.fire("searchfailed"+this.searchTaskId,{error:e,sourceName:t})&&(this.searchTaskId+=1))}},{key:"_searchFeaturesSucceed",value:function(e,t){this.errorSourceList[t]&&delete this.errorSourceList[t],0<e.length&&(this.searchResult[t]={source:t,result:e});var r,o=[];for(r in this.searchResult)o.push(this.searchResult[r]);this.fire("searchsucceeded"+this.searchTaskId,{result:o})&&(this.searchTaskId+=1)}},{key:"_searchFromPOI",value:function(e){var t=this,r="Online 本地搜索",e=(this.geoCodeParam={pageSize:this.options.pageSize||10,pageNum:this.options.pageNum||1,city:e.city},this.geoCodeParam.keyWords=this.keyWord,this._getSearchUrl(this.geoCodeParam));SuperMap.FetchRequest.get(e).then(function(e){return e.json()}).then(function(e){e.error?t._searchFeaturesFailed(e.error,r):e.poiInfos&&0===e.poiInfos.length?t._searchFeaturesSucceed([],r):e.poiInfos&&(e=t._dataToGeoJson(e.poiInfos,t.geoCodeParam),t._searchFeaturesSucceed(e.slice(0,t.maxFeatures),r))}).catch(function(e){t._searchFeaturesFailed(e,r)})}},{key:"_searchFromRestMap",value:function(e){var r=this,o="Rest Map Search";e.forEach(function(t){var e={},e=(t.proxy&&(e.proxy=t.proxy),t.epsgCode&&(e.epsgCode=t.epsgCode),new h.a(t.url,e));e.on({getdatafailed:function(){r._searchFeaturesFailed("",t.name||o)},featureisempty:function(){r._searchFeaturesSucceed([],t.name||o)},getdatasucceeded:function(e){e.features&&(e=r._getFeaturesByKeyWord(r.keyWord,e.features),r._searchFeaturesSucceed(e,t.name||o))}}),e.getMapFeatures({dataUrl:t.url,mapName:t.layerName},{maxFeatures:r.maxFeatures,keyWord:r.keyWord})},this)}},{key:"_searchFromRestData",value:function(e){var n=this,a="Rest Data Search";e.forEach(function(t){var e={},e=(t.proxy&&(e.proxy=t.proxy),t.epsgCode&&(e.epsgCode=t.epsgCode),new h.a(t.url,e)),r=(e.on({getdatafailed:function(){n._searchFeaturesFailed("",t.name||a)},featureisempty:function(){n._searchFeaturesSucceed([],t.name||a)},getdatasucceeded:function(e){e.features&&0<e.features.length&&(e=n._getFeaturesByKeyWord(n.keyWord,e.features),n._searchFeaturesSucceed(e,t.name||a))}}),t.dataName[0].split(":")[0]),o=t.dataName[0].split(":")[1];e.getDataFeatures({datasetName:o,dataSourceName:r,dataUrl:t.url},{maxFeatures:n.maxFeatures,keyWord:n.keyWord})},this)}},{key:"_searchFromIportal",value:function(e){var r=this,o="Iportal Search";e.forEach(function(t){var e=new l.a(t.url,t.withCredentials||!1,{epsgCode:t.epsgCode});e.on({getdatafailed:function(){r._searchFeaturesFailed("",t.name||o)},featureisempty:function(){r._searchFeaturesSucceed([],t.name||o)},getdatasucceeded:function(e){e.features&&(e=r._getFeaturesByKeyWord(r.keyWord,e.features),r._searchFeaturesSucceed(e,t.name||o))}}),e.getData({keyWord:r.keyWord})},this)}},{key:"_searchFromAddressMatch",value:function(e){var r=this,o="Address Match Search";e.forEach(function(t){var e={},e=(t.proxy&&(e.proxy=t.proxy),r.addressMatchService=new i.a.supermap.AddressMatchService(t.url,e),{address:r.keyWord,fromIndex:0,toIndex:r.maxFeatures,maxReturn:r.maxFeatures,prjCoordSys:"{epsgcode:4326}"}),e=new SuperMap.GeoCodingParameter(e);r.addressMatchService.code(e,function(e){e.result?r._searchFeaturesSucceed(e.result,t.name||o):r._searchFeaturesFailed("",t.name||o)})},this)}},{key:"_dataToGeoJson",value:function(e,t){for(var r=[],o=0;o<e.length;o++){var n={type:"Feature",geometry:{type:"Point",coordinates:[e[o].location.x,e[o].location.y]},properties:{name:e[o].name||t.keyWords,address:e[o].formatedAddress||e[o].address},filterAttribute:{filterAttributeName:e[o].name||t.keyWords,filterAttributeValue:e[o].formatedAddress||e[o].address||Object(p.a)().t("search.null")},filterVal:"".concat(e[o].name||t.keyWords,"：").concat(e[o].formatedAddress||e[o].address||Object(p.a)().t("search.null"))};r.push(n)}return r}},{key:"_getSearchUrl",value:function(e){return this.options.cityGeoCodingConfig.addressUrl+".json?keywords=".concat(e.keyWords,"&city=").concat(e.city||"北京市","&pageSize=").concat(e.pageSize,"&pageNum=").concat(e.pageNum,"&key=").concat(this.options.cityGeoCodingConfig.key)}},{key:"_getFeaturesByKeyWord",value:function(e,t){var n=this,a=[],s=new RegExp(e.toLowerCase()),i=this._getAttributeNames(t);return t.forEach(function(r){if(!r.properties)return null;var o=r.properties;i.forEach(function(e){var t;o[e]&&s.test(o[e].toString().toLowerCase())&&(t=o[e=e]||Object(p.a)().t("search.null"),r.filterAttribute||(r.filterAttribute={filterAttributeName:e,filterAttributeValue:t},r.filterVal="".concat(e,"：").concat(t),a.push(r)))},n)}),a}},{key:"_getAttributeNames",value:function(e){var t=[],e=e[0].properties;return e&&Object.keys(e).forEach(function(e){t.push(e)},this),t}},{key:"_clearMarkers",value:function(){this.markerList.length&&(this.markerList.forEach(function(e){e&&e.remove()}),this.markerList=[])}},{key:"_clearPopups",value:function(){this.popupList.length&&(this.popupList.forEach(function(e){e&&e.remove()}),this.popupList=[])}},{key:"_clearSearchResultLayer",value:function(){this.map&&this.map.getLayer("searchResultLayer")&&(this.map.removeLayer("searchResultLayer"),this.map.removeSource("searchResultLayer"))}},{key:"_resetSearchSourceData",value:function(){this.map&&this.map.getSource("searchResultLayer")&&this.map.getSource("searchResultLayer").setData({type:"FeatureCollection",features:[]})}},{key:"_reset",value:function(){this._resetSearchSourceData(),this._clearMarkers(),this._clearPopups()}},{key:"removed",value:function(){this.searchTaskId=0,this.searchResult={},this.errorSourceList={},this.options.resultRender||(this._clearSearchResultLayer(),this._clearMarkers(),this._clearPopups())}}])&&v(t.prototype,e),r&&v(t,r),Object.defineProperty(t,"prototype",{writable:!1}),n}(i.a.Evented),s=r("SqLP"),O=r("QsSW"),_=r("K79h"),T=r("oUIn"),C=r("XaGS"),P=r.n(C);function j(e){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function x(t,e){var r,o=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,r)),o}function I(o){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?x(Object(n),!0).forEach(function(e){var t,r;t=o,r=n[e=e],(e=function(e){e=function(e,t){if("object"!==j(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!==j(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===j(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach(function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(n,e))})}return o}C={name:"SmSearch",components:{SmIcon:s.default,SmInput:O.a,TablePopup:T.a},mixins:[a.a,n.a,o.a],props:{maxFeatures:{type:[Number,String],default:8},layerNames:{type:Array},onlineLocalSearch:{type:Object,default:function(){return{enable:!0,city:"北京市"}}},restMap:{type:Array},restData:{type:Array},iportalData:{type:Array},addressMatch:{type:Array},mode:{type:String,default:"control",validator:function(e){return-1!==["control","toolBar"].indexOf(e)}},openSearchSuggestion:{type:Boolean,default:!1},alwaysCenter:{type:Boolean,default:!0},showTitle:{type:Boolean,default:!0},showResult:{type:Boolean,default:!0},resultRender:{type:Function},collapsed:{type:Boolean,default:!1},splitLine:{type:Boolean,default:!0}},data:function(){return{searchKey:null,searchResult:[],prefixType:"search",isActive:!1,tablePopupProps:{},showSearch:!0,showIcon:!1,isInputing:!1,isSuggestion:!1,keyupHoverInfo:{groupIndex:void 0,hoverIndex:void 0}}},computed:{resultSuggestions:function(){return!(!this.isSuggestion&&!this.showResult)&&0<this.searchResult.length}},watch:{iportalData:function(e,t){this.searchKey&&!P()(e,t)&&this.search()},restData:function(e,t){this.searchKey&&!P()(e,t)&&this.search()},restMap:function(e,t){this.searchKey&&!P()(e,t)&&this.search()},addressMatch:function(e,t){this.searchKey&&!P()(e,t)&&this.search()}},created:function(){this.showSearch=!this.collapsed,this.showIcon=this.collapsed,this.viewModel=new k(this.$props)},removed:function(){this.clearResult(!0)},beforeDestroy:function(){_.a.destroy()},methods:{clearResult:function(e){_.a.destroy(),e&&(this.searchKey=null),e&&this.resetLastEvent(),this.searchResult=[],this.prefixType="search",this.keyupHoverInfo={groupIndex:void 0,hoverIndex:void 0},this.viewModel&&this.viewModel.removed()},searchInput:function(){this.openSearchSuggestion&&!this.isInputing&&(this.searchKey?(this.isSuggestion=!0,this.search()):this.inputValueCleared(!1))},searchButtonClicked:function(){this.isSuggestion=!1,this.search()},search:function(){var e,t,r,o,n,a;this.clearResult(),this.mapNotLoadedTip()||(e=(a=this.$props).layerNames,t=a.onlineLocalSearch,r=a.restMap,o=a.restData,n=a.iportalData,a=a.addressMatch,e&&0<e.length||t.enable||r&&0<r.length||o&&0<o.length||n&&0<n.length||a&&0<a.length?this.searchKey?(this.searchTaskId=this.viewModel.search(this.searchKey),this.regiterEvents(),this.prefixType="loading"):_.a.warning(this.$t("search.noKey")):_.a.warning(this.$t("search.setSearchSource")))},inputValueCleared:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.clearResult(!0),this.viewModel&&this.viewModel.removed(),e&&this.$emit("clear-search-result")},searchResultListClicked:function(e,t){t=t.target.innerHTML;this.isSuggestion=!1,this.viewModel.getFeatureInfo(t,e)},resetLastEvent:function(){/\d/.test(this.searchTaskId)&&(this.viewModel.off("searchsucceeded"+this.searchTaskId),this.viewModel.off("searchfailed"+this.searchTaskId),this.viewModel.off("set-popup-content"+this.searchTaskId),this.viewModel.off("addfeaturefailed"+this.illegalFeatureTip),this.viewModel.off("search-selected-info"+this.searchTaskId),this.searchTaskId=void 0)},registerSuccessEvent:function(e){this.viewModel.on("searchsucceeded"+e,this.searchSucceeded)},registerFailedEvent:function(e){this.viewModel.on("searchfailed"+e,this.searchFailed)},regiterEvents:function(){this.isNumber(this.searchTaskId)&&(this.viewModel.off("searchsucceeded"+(this.searchTaskId-1),this.searchSucceeded),this.viewModel.off("searchsucceeded"+(this.searchTaskId-1),this.searchFailed),this.viewModel.off("set-popup-content"+(this.searchTaskId-1),this.setPopupContent),this.viewModel.off("addfeaturefailed"+(this.searchTaskId-1),this.illegalFeatureTip),this.viewModel.off("search-selected-info"+(this.searchTaskId-1),this.searchSelectedInfo));var e=this.searchTaskId||0;this.registerSuccessEvent(e),this.registerFailedEvent(e),this.viewModel.on("set-popup-content"+e,this.setPopupContent),this.viewModel.on("addfeaturefailed"+e,this.illegalFeatureTip),this.viewModel.on("search-selected-info"+e,this.searchSelectedInfo)},searchSucceeded:function(e){e=e.result;_.a.destroy(),this.searchResult=e,this.$emit("search-succeeded",{searchResult:this.searchResult}),this.prefixType="search",this.isNumber(this.searchTaskId)&&(this.searchTaskId+=1,this.regiterEvents())},searchFailed:function(e){this.clearResult(),this.prefixType="search",this.$emit("search-failed",e),this.isNumber(this.searchTaskId)&&(this.searchTaskId+=1,this.regiterEvents())},setPopupContent:function(e){var t=this,r=e.popupData;r&&r.info.length&&(e={columns:[{title:this.$t("search.attribute"),dataIndex:"attribute",width:80},{title:this.$t("search.attributeValue"),dataIndex:"attributeValue",width:150}],data:r.info},this.tablePopupProps=I({},e)),this.$nextTick(function(){t.viewModel.setPopupContent(r.coordinates,t.$refs.searchTablePopup.$el,function(){return Object(f.t)(t.tablePopupBgData)})})},illegalFeatureTip:function(e){e=e.error;_.a.destroy(),_.a.error(e)},searchSelectedInfo:function(e){e=e.data;this.prefixType="search",this.resultRender&&this.resultRender(e),this.$emit("search-selected-info",e)},isNumber:function(e){return/\d/.test(e)},downChoose:function(){var e=this.searchResult.filter(function(e){return e.result.length}).length,t=this.keyupHoverInfo,r=t.groupIndex,t=t.hoverIndex,o=((r=void 0===r?0:r)?this.searchResult[r]:this.searchResult[0]).result.length,r=r<e-1&&o-1<=t?Math.min(e-1,r+1):r===e-1&&t===o-1?0:r,e=(this.isNumber(t)&&t<o-1?this.keyupHoverInfo.hoverIndex=t+1:(this.keyupHoverInfo.groupIndex=r,this.keyupHoverInfo.hoverIndex=0),this.searchResult[r].result[this.keyupHoverInfo.hoverIndex]);this.searchKey=(e.filterVal||e.name||e.address).split("：")[0]},upChoose:function(){var e=this.searchResult.filter(function(e){return e.result.length}).length,t=this.keyupHoverInfo,r=t.groupIndex,t=t.hoverIndex,r=0<(r=void 0===r?0:r)&&!t?Math.max(0,r-1):r||t?r:e-1,e=(this.isNumber(t)&&0<t?this.keyupHoverInfo.hoverIndex=t-1:(this.keyupHoverInfo.groupIndex=r,this.keyupHoverInfo.hoverIndex=Math.max(this.searchResult[r].result.length-1,0)),this.searchResult[r].result[this.keyupHoverInfo.hoverIndex]);this.searchKey=(e.filterVal||e.name||e.address).split("：")[0]},changeResultHover:function(e){e=e.keyCode;38===e?this.upChoose():40===e&&this.downChoose()}}},s=r("KHd+"),O=Object(s.a)(C,function(){var o=this,e=o.$createElement,n=o._self._c||e;return n("div",{staticClass:"sm-component-search",style:o.headingTextColorStyle,attrs:{id:"sm-component-search"}},[o.showIcon&&"control"===o.mode?n("div",{staticClass:"sm-component-search__toggle-icon",style:o.collapseCardHeaderBgStyle,on:{click:function(e){o.showSearch=!o.showSearch,o.showIcon=!o.showIcon}}},[n("i",{staticClass:"sm-components-icon-search"})]):o._e(),o._v(" "),n("transition",{attrs:{name:"sm-component-zoom-in"},on:{"after-leave":function(e){o.showIcon=!o.showIcon}}},[n("div",{directives:[{name:"show",rawName:"v-show",value:o.showSearch||"toolBar"===o.mode,expression:"showSearch || mode === 'toolBar'"}],staticClass:"sm-component-search__content",style:[{"transform-origin":o.position.includes("left")?"top left":"top right"},o.collapseCardHeaderBgStyle]},[n("div",{class:{"sm-component-search__input":!0,"with-split-line":o.splitLine},style:o.collapseCardHeaderBgStyle,attrs:{"aria-orientation":o.position.includes("left")?"left":"right"}},["control"===o.mode?n("div",{staticClass:"sm-component-search__arrow-icon",on:{click:function(e){o.showSearch=!o.showSearch}}},[n("i",{class:o.position.includes("left")?"sm-components-icon-double-left":"sm-components-icon-double-right"})]):o._e(),o._v(" "),n("div",{staticClass:"sm-component-search__search-icon",on:{click:o.searchButtonClicked}},[n("sm-icon",{attrs:{type:o.prefixType}})],1),o._v(" "),n("sm-input",{class:["sm-component-search__a-input",{"toolBar-input":"toolBar"===o.mode}],attrs:{placeholder:o.$t("search.inputPlaceHolder"),allowClear:""},on:{input:o.searchInput,compositionstart:function(e){o.isInputing=!0},compositionend:function(e){o.isInputing=!1},pressEnter:o.searchButtonClicked,focus:function(e){o.isActive=!o.isActive},blur:function(e){o.isActive=!o.isActive},keyup:o.changeResultHover,change:function(e){return!e.target.value&&o.inputValueCleared()}},model:{value:o.searchKey,callback:function(e){o.searchKey=e},expression:"searchKey"}})],1),o._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:o.resultSuggestions,expression:"resultSuggestions"}],staticClass:"sm-component-search__result",style:o.collapseCardBackgroundStyle},o._l(o.searchResult,function(e,r){return n("div",{key:r,staticClass:"sm-component-search__panel"},[e.source&&o.showTitle&&e.result.length?n("div",{staticClass:"sm-component-search__panel-header-wrapper"},[n("div",{staticClass:"sm-component-search__panel-header"},[n("i",{staticClass:"sm-components-icon-list"}),o._v(" "),n("span",{staticClass:"add-ellipsis"},[o._v(o._s(e.source))])])]):o._e(),o._v(" "),e.result?n("div",{staticClass:"sm-component-search__panel-body",style:o.getTextColorStyle},[n("ul",{class:{noMarginBottom:!o.showTitle}},o._l(e.result,function(t,e){return n("li",{key:e,class:{active:o.keyupHoverInfo.groupIndex===r&&o.keyupHoverInfo.hoverIndex===e,"add-ellipsis":!0},attrs:{title:t.filterVal||t.name||t.address},on:{click:function(e){return o.searchResultListClicked(t,e)}}},[o._v(o._s(t.filterVal||t.name||t.address))])}),0)]):o._e()])}),0)])]),o._v(" "),n("TablePopup",o._b({directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"searchTablePopup",attrs:{"split-line":o.splitLine,"text-color":o.textColor,background:o.background}},"TablePopup",o.tablePopupProps,!1))],1)},[],!1,null,null,null);t.default=O.exports},dDBl:function(e,t,r){"use strict";var o=r("TuIa"),n=r("FhCG"),a=r("oTir"),s=r("tmJK"),n=Object.assign({},n.TableProps),o={name:"SmTable",defaultComponent:o.default,mixins:[a.a,s.a],inheritAttrs:!1,props:n},a=r("KHd+"),s=Object(a.a)(o,void 0,void 0,!1,null,null,null);t.a=s.exports},oUIn:function(e,t,r){"use strict";var o=r("oTir"),n=r("dDBl"),a=r("qAG6"),n={name:"SmTablePopup",components:{SmTable:n.a},mixins:[o.a],props:{data:{type:Array,default:function(){return[]}},columns:{type:Array,default:function(){return[]}},splitLine:{type:Boolean,default:!0}},watch:{"collapseCardHeaderBgStyle.background":function(e){this.setTheadStyle("background",e)},"tablePopupBgStyle.background":function(e){Object(a.t)(e)},"headingTextColorStyle.color":function(e){this.setTheadStyle("color",e)}},mounted:function(){this.setTheadStyle("color",this.headingTextColorStyle.color),this.setTheadStyle("background",this.collapseCardHeaderBgStyle.background)},methods:{setTheadStyle:function(t,r){var e;this.$el&&(e=this.$el.querySelectorAll("tr > th"))&&e.forEach(function(e){e.style[t]=r})}}},o=r("KHd+"),r=Object(o.a)(n,function(){var e=this,t=e.$createElement,t=e._self._c||t;return t("div",{class:{"sm-component-table-popup":!0,"with-split-line":e.splitLine},style:[e.tablePopupBgStyle,e.getTextColorStyle]},[t("sm-table",{staticClass:"sm-component-table-popup__table",attrs:{"data-source":e.data,columns:e.columns,rowKey:function(e,t){return t},pagination:!1}})],1)},[],!1,null,null,null);t.a=r.exports},rn6b:function(e,t,r){"use strict";var o=r("oCYn"),n=r("YKMj"),a=r("FuRH");function s(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==l(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!==l(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===l(e)?e:String(e)}(o.key),o)}}function i(e,t){return(i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function c(r){var o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=u(r),t=(e=o?(e=u(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===l(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}r=function(e,t,r,o){var n,a=arguments.length,s=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var i=e.length-1;0<=i;i--)(n=e[i])&&(s=(a<3?n(s):3<a?n(t,r,s):n(t,r))||s);return 3<a&&s&&Object.defineProperty(t,r,s),s},o=function(e){var t=n;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&i(t,e);var r,o=c(n);function n(){var e=this,t=n;if(e instanceof t)return(e=o.apply(this,arguments)).isShow=!0,e;throw new TypeError("Cannot call a class as a function")}return t=n,(e=[{key:"positionChanged",value:function(){this.$el&&this.parentIsWebMapOrMap&&(this.remove(),this.addTo())}},{key:"created",value:function(){var e=this.$parent.$options.name;this.parentIsWebMapOrMap=e&&-1!==["smwebmap","smncpmap"].indexOf(this.$parent.$options.name.toLowerCase())}},{key:"mounted",value:function(){var e;this.filterDelayLoad=!(-1!==["smwebmap","smminimap","smncpmap"].indexOf(this.$options.name&&this.$options.name.toLowerCase())),this.$el&&this.parentIsWebMapOrMap&&(this.filterDelayLoad&&(this.isShow=!1,(e=this.$el).style)&&(e.style.display="none"),e=this.getControlMapName(),a.a.$options.getMap(e)&&this.mapLoaded(a.a.$options.getMap(e)),a.a.$on("load-map",this.controlLoadMapSucceed))}},{key:"beforeDestroy",value:function(){this.remove(),a.a.$off("load-map",this.controlLoadMapSucceed)}},{key:"initControl",value:function(){var e=this;return{onAdd:function(){return e.$el},onRemove:function(){return e.map}}}},{key:"addTo",value:function(){this.control=this.initControl(),this.map.addControl(this.control,this.position),this.$el&&this.$el.classList&&this.$el.classList.add("mapboxgl-ctrl")}},{key:"remove",value:function(){this.control&&this.map&&this.map.removeControl(this.control)}},{key:"getControlMapName",value:function(){var e=this.$parent,e=e&&e.$options.name&&"smwebmap"===e.$options.name.toLowerCase()&&e.target;return this.mapTarget||e||Object.keys(a.a.$options.getAllMaps())[0]}},{key:"controlLoadMapSucceed",value:function(e,t){t===this.getControlMapName()&&this.mapLoaded(e)}},{key:"mapLoaded",value:function(e){this.map=e,this.addTo(),this.filterDelayLoad&&(this.isShow=!0,e=this.$el)&&e.style&&(e.style.display="block")}}])&&s(t.prototype,e),r&&s(t,r),Object.defineProperty(t,"prototype",{writable:!1}),n}(o.default);r([Object(n.Prop)()],o.prototype,"mapTarget",void 0),r([Object(n.Prop)({default:"top-left",validator:function(e){return-1!==["top-left","top-right","bottom-left","bottom-right"].indexOf(e)}})],o.prototype,"position",void 0),r([Object(n.Watch)("position")],o.prototype,"positionChanged",null),o=r([n.Component],o),t.a=o}}]);